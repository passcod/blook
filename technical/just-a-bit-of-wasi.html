<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Just a bit of wasi - Félix Saparelli</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../avatars/index.html"><strong aria-hidden="true">2.</strong> Avatars</a></li><li class="chapter-item expanded "><a href="../info/index.html"><strong aria-hidden="true">3.</strong> Persistent information</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../info/keys.html"><strong aria-hidden="true">3.1.</strong> Cryptographic keys</a></li><li class="chapter-item "><a href="../info/social-media.html"><strong aria-hidden="true">3.2.</strong> Social media policies</a></li><li class="chapter-item "><a href="../info/trademark.html"><strong aria-hidden="true">3.3.</strong> Trademark</a></li></ol></li><li class="chapter-item expanded "><a href="../fiction/index.html"><strong aria-hidden="true">4.</strong> Fiction</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../fiction/poetry/index.html"><strong aria-hidden="true">4.1.</strong> Poetry</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../fiction/poetry/only-one-left.html"><strong aria-hidden="true">4.1.1.</strong> Only One Left</a></li><li class="chapter-item "><a href="../fiction/poetry/mid-loss.html"><strong aria-hidden="true">4.1.2.</strong> Mid-loss</a></li><li class="chapter-item "><a href="../fiction/poetry/aftermath.html"><strong aria-hidden="true">4.1.3.</strong> Aftermath</a></li><li class="chapter-item "><a href="../fiction/poetry/one-and-two.html"><strong aria-hidden="true">4.1.4.</strong> one and two</a></li><li class="chapter-item "><a href="../fiction/poetry/grow.html"><strong aria-hidden="true">4.1.5.</strong> Grow</a></li><li class="chapter-item "><a href="../fiction/poetry/slowly.html"><strong aria-hidden="true">4.1.6.</strong> Slowly</a></li><li class="chapter-item "><a href="../fiction/poetry/alya.html"><strong aria-hidden="true">4.1.7.</strong> Alya</a></li><li class="chapter-item "><a href="../fiction/poetry/so-many-alone-at-night.html"><strong aria-hidden="true">4.1.8.</strong> so many alone at night</a></li><li class="chapter-item "><a href="../fiction/poetry/up-up-and-away.html"><strong aria-hidden="true">4.1.9.</strong> Up Up And Away</a></li><li class="chapter-item "><a href="../fiction/poetry/sleep.html"><strong aria-hidden="true">4.1.10.</strong> Sleep</a></li><li class="chapter-item "><a href="../fiction/poetry/hold.html"><strong aria-hidden="true">4.1.11.</strong> Hold</a></li><li class="chapter-item "><a href="../fiction/poetry/sorry.html"><strong aria-hidden="true">4.1.12.</strong> Sorry</a></li><li class="chapter-item "><a href="../fiction/poetry/right-over-there.html"><strong aria-hidden="true">4.1.13.</strong> Right over there</a></li><li class="chapter-item "><a href="../fiction/poetry/the-road-to-hell.html"><strong aria-hidden="true">4.1.14.</strong> The Road to Hell</a></li><li class="chapter-item "><a href="../fiction/poetry/self.html"><strong aria-hidden="true">4.1.15.</strong> Self</a></li><li class="chapter-item "><a href="../fiction/poetry/tree.html"><strong aria-hidden="true">4.1.16.</strong> Tree</a></li><li class="chapter-item "><a href="../fiction/poetry/unlit.html"><strong aria-hidden="true">4.1.17.</strong> Unlit</a></li><li class="chapter-item "><a href="../fiction/poetry/one-summer-morning.html"><strong aria-hidden="true">4.1.18.</strong> One summer morning</a></li><li class="chapter-item "><a href="../fiction/poetry/smile.html"><strong aria-hidden="true">4.1.19.</strong> Smile</a></li></ol></li><li class="chapter-item "><a href="../fiction/shorts/index.html"><strong aria-hidden="true">4.2.</strong> Short Prose</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../fiction/shorts/the-box.html"><strong aria-hidden="true">4.2.1.</strong> The Box</a></li><li class="chapter-item "><a href="../fiction/shorts/a-man.html"><strong aria-hidden="true">4.2.2.</strong> A Man</a></li><li class="chapter-item "><a href="../fiction/shorts/alive-in-the-night.html"><strong aria-hidden="true">4.2.3.</strong> ali.vei.nth.eni.ght</a></li><li class="chapter-item "><a href="../fiction/shorts/regulus.html"><strong aria-hidden="true">4.2.4.</strong> Regulus</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../fiction/shorts/regulus-notes.html"><strong aria-hidden="true">4.2.4.1.</strong> (notes for) Regulus</a></li></ol></li><li class="chapter-item "><a href="../fiction/shorts/my-mountain-of-knowledge.html"><strong aria-hidden="true">4.2.5.</strong> My mountain of Knowledge</a></li><li class="chapter-item "><a href="../fiction/shorts/finally-i-knew.html"><strong aria-hidden="true">4.2.6.</strong> Finally, I knew</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../technical/index.html"><strong aria-hidden="true">5.</strong> Technicals</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../technical/async-generator-state-machine.html"><strong aria-hidden="true">5.1.</strong> A little elegant state machine with Async Generators</a></li><li class="chapter-item "><a href="../technical/dhall-review.html"><strong aria-hidden="true">5.2.</strong> Dhall: not quite it</a></li><li class="chapter-item "><a href="../technical/exploring-wasm.html"><strong aria-hidden="true">5.3.</strong> Exploration of Wasm</a></li><li class="chapter-item "><a href="../technical/rust-crimes-enum-ints.html"><strong aria-hidden="true">5.4.</strong> Rust crimes: Enum ints</a></li><li class="chapter-item "><a href="../technical/no-time-for-chrono.html"><strong aria-hidden="true">5.5.</strong> No Time for Chrono</a></li><li class="chapter-item expanded "><a href="../technical/just-a-bit-of-wasi.html" class="active"><strong aria-hidden="true">5.6.</strong> Just a bit of wasi</a></li></ol></li><li class="chapter-item expanded "><a href="../musings/index.html"><strong aria-hidden="true">6.</strong> Musings</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../musings/gaston-lagaffe/index.html"><strong aria-hidden="true">6.1.</strong> Gaston Lagaffe</a></li><li class="chapter-item "><a href="../musings/known-unknowns-conflang.html"><strong aria-hidden="true">6.2.</strong> Known Unknowns: a configuration language</a></li><li class="chapter-item "><a href="../musings/on-the-difficulty-of-automated-unblocking.html"><strong aria-hidden="true">6.3.</strong> On the difficulty of automated unblocking</a></li><li class="chapter-item "><a href="../musings/on-invoking-deities.html"><strong aria-hidden="true">6.4.</strong> On Invoking Deities</a></li></ol></li><li class="chapter-item expanded "><a href="../models/index.html"><strong aria-hidden="true">7.</strong> 3D Models</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../models/mijia-hang/index.html"><strong aria-hidden="true">7.1.</strong> Mijia Hang</a></li><li class="chapter-item "><a href="../models/filabox/index.html"><strong aria-hidden="true">7.2.</strong> Filabox</a></li></ol></li><li class="chapter-item expanded "><a href="../recipes/index.html"><strong aria-hidden="true">8.</strong> Recipes</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div><strong aria-hidden="true">8.1.</strong> Thermomix</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../recipes/thermomix/dairy-cream.html"><strong aria-hidden="true">8.1.1.</strong> No-effort Dairy Cream</a></li><li class="chapter-item "><a href="../recipes/thermomix/pasta.html"><strong aria-hidden="true">8.1.2.</strong> Semi-steamed Pasta</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../updates/index.html"><strong aria-hidden="true">9.</strong> Progress updates</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../updates/projects/certainly.html"><strong aria-hidden="true">9.1.</strong> Certainly</a></li><li class="chapter-item "><a href="../updates/projects/japanese.html"><strong aria-hidden="true">9.2.</strong> Japanese</a></li><li class="chapter-item "><a href="../updates/projects/lah-kara.html"><strong aria-hidden="true">9.3.</strong> Lah Kara</a></li><li class="chapter-item "><a href="../updates/projects/sassbot.html"><strong aria-hidden="true">9.4.</strong> Sassbot</a></li><li class="chapter-item "><a href="../updates/projects/splash.html"><strong aria-hidden="true">9.5.</strong> Splash</a></li><li class="chapter-item "><a href="../updates/projects/cargo-watchexec.html"><strong aria-hidden="true">9.6.</strong> Watchexec family</a></li><li class="chapter-item "><div><strong aria-hidden="true">9.7.</strong> Archived</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../updates/projects/accord.html"><strong aria-hidden="true">9.7.1.</strong> Accord</a></li><li class="chapter-item "><a href="../updates/projects/armstrong.html"><strong aria-hidden="true">9.7.2.</strong> Armstrong</a></li><li class="chapter-item "><a href="../updates/projects/caretaker.html"><strong aria-hidden="true">9.7.3.</strong> Caretaker</a></li><li class="chapter-item "><a href="../updates/projects/car-rainbow.html"><strong aria-hidden="true">9.7.4.</strong> Car Rainbow</a></li><li class="chapter-item "><a href="../updates/projects/ct.html"><strong aria-hidden="true">9.7.5.</strong> ct</a></li><li class="chapter-item "><a href="../updates/projects/defnew.html"><strong aria-hidden="true">9.7.6.</strong> defnew</a></li><li class="chapter-item "><a href="../updates/projects/eqsky.html"><strong aria-hidden="true">9.7.7.</strong> Earthquake Sky</a></li><li class="chapter-item "><a href="../updates/projects/figleaf.html"><strong aria-hidden="true">9.7.8.</strong> Figleaf</a></li><li class="chapter-item "><a href="../updates/projects/glass-hanger.html"><strong aria-hidden="true">9.7.9.</strong> Glass Hanger</a></li><li class="chapter-item "><a href="../updates/projects/entry-insert.html"><strong aria-hidden="true">9.7.10.</strong> Hashmap Entry Insert</a></li><li class="chapter-item "><a href="../updates/projects/intpath.html"><strong aria-hidden="true">9.7.11.</strong> IntPath</a></li><li class="chapter-item "><a href="../updates/projects/irish.html"><strong aria-hidden="true">9.7.12.</strong> Irish</a></li><li class="chapter-item "><a href="../updates/projects/keycasting.html"><strong aria-hidden="true">9.7.13.</strong> Keycasting</a></li><li class="chapter-item "><a href="../updates/projects/mead.html"><strong aria-hidden="true">9.7.14.</strong> Mead</a></li><li class="chapter-item "><a href="../updates/projects/notify.html"><strong aria-hidden="true">9.7.15.</strong> Notify</a></li><li class="chapter-item "><a href="../updates/projects/omelette.html"><strong aria-hidden="true">9.7.16.</strong> Omelette</a></li><li class="chapter-item "><a href="../updates/projects/pinn.html"><strong aria-hidden="true">9.7.17.</strong> Pinn</a></li><li class="chapter-item "><a href="../updates/projects/reasonable.html"><strong aria-hidden="true">9.7.18.</strong> Reasonable</a></li><li class="chapter-item "><a href="../updates/projects/reupholstery.html"><strong aria-hidden="true">9.7.19.</strong> Reupholstering chairs</a></li><li class="chapter-item "><a href="../updates/projects/storq.html"><strong aria-hidden="true">9.7.20.</strong> Storq</a></li><li class="chapter-item "><a href="../updates/projects/swp.html"><strong aria-hidden="true">9.7.21.</strong> Swp</a></li><li class="chapter-item "><a href="../updates/projects/trebuchet.html"><strong aria-hidden="true">9.7.22.</strong> Trebuchet</a></li><li class="chapter-item "><a href="../updates/projects/what.html"><strong aria-hidden="true">9.7.23.</strong> What</a></li></ol></li><li class="chapter-item "><a href="../updates/dated/index.html"><strong aria-hidden="true">9.8.</strong> 2017-2019 (mostly) regular micro updates</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../updates/dated/2016.html"><strong aria-hidden="true">9.8.1.</strong> 2016</a></li><li class="chapter-item "><a href="../updates/dated/2017/index.html"><strong aria-hidden="true">9.8.2.</strong> 2017</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../updates/dated/2017/january.html"><strong aria-hidden="true">9.8.2.1.</strong> January</a></li><li class="chapter-item "><a href="../updates/dated/2017/february.html"><strong aria-hidden="true">9.8.2.2.</strong> February</a></li><li class="chapter-item "><a href="../updates/dated/2017/march.html"><strong aria-hidden="true">9.8.2.3.</strong> March</a></li><li class="chapter-item "><a href="../updates/dated/2017/april.html"><strong aria-hidden="true">9.8.2.4.</strong> April</a></li><li class="chapter-item "><a href="../updates/dated/2017/may.html"><strong aria-hidden="true">9.8.2.5.</strong> May</a></li><li class="chapter-item "><a href="../updates/dated/2017/june.html"><strong aria-hidden="true">9.8.2.6.</strong> June</a></li><li class="chapter-item "><a href="../updates/dated/2017/july.html"><strong aria-hidden="true">9.8.2.7.</strong> July</a></li><li class="chapter-item "><a href="../updates/dated/2017/august.html"><strong aria-hidden="true">9.8.2.8.</strong> August</a></li><li class="chapter-item "><a href="../updates/dated/2017/september.html"><strong aria-hidden="true">9.8.2.9.</strong> September</a></li><li class="chapter-item "><a href="../updates/dated/2017/october.html"><strong aria-hidden="true">9.8.2.10.</strong> October</a></li><li class="chapter-item "><a href="../updates/dated/2017/november.html"><strong aria-hidden="true">9.8.2.11.</strong> November</a></li><li class="chapter-item "><a href="../updates/dated/2017/december.html"><strong aria-hidden="true">9.8.2.12.</strong> December</a></li></ol></li><li class="chapter-item "><a href="../updates/dated/2018/index.html"><strong aria-hidden="true">9.8.3.</strong> 2018</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../updates/dated/2018/january.html"><strong aria-hidden="true">9.8.3.1.</strong> January</a></li><li class="chapter-item "><a href="../updates/dated/2018/march.html"><strong aria-hidden="true">9.8.3.2.</strong> March</a></li><li class="chapter-item "><a href="../updates/dated/2018/april.html"><strong aria-hidden="true">9.8.3.3.</strong> April</a></li><li class="chapter-item "><a href="../updates/dated/2018/may.html"><strong aria-hidden="true">9.8.3.4.</strong> May</a></li><li class="chapter-item "><a href="../updates/dated/2018/september.html"><strong aria-hidden="true">9.8.3.5.</strong> September</a></li><li class="chapter-item "><a href="../updates/dated/2018/november.html"><strong aria-hidden="true">9.8.3.6.</strong> November</a></li><li class="chapter-item "><a href="../updates/dated/2018/december.html"><strong aria-hidden="true">9.8.3.7.</strong> December</a></li></ol></li><li class="chapter-item "><a href="../updates/dated/2019/index.html"><strong aria-hidden="true">9.8.4.</strong> 2019</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../updates/dated/2019/january.html"><strong aria-hidden="true">9.8.4.1.</strong> January</a></li><li class="chapter-item "><a href="../updates/dated/2019/february.html"><strong aria-hidden="true">9.8.4.2.</strong> February</a></li><li class="chapter-item "><a href="../updates/dated/2019/march.html"><strong aria-hidden="true">9.8.4.3.</strong> March</a></li><li class="chapter-item "><a href="../updates/dated/2019/april.html"><strong aria-hidden="true">9.8.4.4.</strong> April</a></li><li class="chapter-item "><a href="../updates/dated/2019/september.html"><strong aria-hidden="true">9.8.4.5.</strong> September</a></li><li class="chapter-item "><a href="../updates/dated/2019/december.html"><strong aria-hidden="true">9.8.4.6.</strong> December</a></li></ol></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../reading/index.html"><strong aria-hidden="true">10.</strong> Reading archive</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../reading/2016/index.html"><strong aria-hidden="true">10.1.</strong> 2016</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../reading/2016/july.html"><strong aria-hidden="true">10.1.1.</strong> July</a></li><li class="chapter-item "><a href="../reading/2016/december.html"><strong aria-hidden="true">10.1.2.</strong> December</a></li></ol></li><li class="chapter-item "><a href="../reading/2017/index.html"><strong aria-hidden="true">10.2.</strong> 2017</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../reading/2017/january.html"><strong aria-hidden="true">10.2.1.</strong> January</a></li><li class="chapter-item "><a href="../reading/2017/february.html"><strong aria-hidden="true">10.2.2.</strong> February</a></li><li class="chapter-item "><a href="../reading/2017/march.html"><strong aria-hidden="true">10.2.3.</strong> March</a></li><li class="chapter-item "><a href="../reading/2017/april.html"><strong aria-hidden="true">10.2.4.</strong> April</a></li><li class="chapter-item "><a href="../reading/2017/may.html"><strong aria-hidden="true">10.2.5.</strong> May</a></li><li class="chapter-item "><a href="../reading/2017/june.html"><strong aria-hidden="true">10.2.6.</strong> June</a></li><li class="chapter-item "><a href="../reading/2017/july.html"><strong aria-hidden="true">10.2.7.</strong> July</a></li><li class="chapter-item "><a href="../reading/2017/august.html"><strong aria-hidden="true">10.2.8.</strong> August</a></li><li class="chapter-item "><a href="../reading/2017/september.html"><strong aria-hidden="true">10.2.9.</strong> September</a></li><li class="chapter-item "><a href="../reading/2017/october.html"><strong aria-hidden="true">10.2.10.</strong> October</a></li><li class="chapter-item "><a href="../reading/2017/november.html"><strong aria-hidden="true">10.2.11.</strong> November</a></li><li class="chapter-item "><a href="../reading/2017/december.html"><strong aria-hidden="true">10.2.12.</strong> December</a></li></ol></li><li class="chapter-item "><a href="../reading/2018/index.html"><strong aria-hidden="true">10.3.</strong> 2018</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../reading/2018/january.html"><strong aria-hidden="true">10.3.1.</strong> January</a></li><li class="chapter-item "><a href="../reading/2018/february.html"><strong aria-hidden="true">10.3.2.</strong> February</a></li><li class="chapter-item "><a href="../reading/2018/march.html"><strong aria-hidden="true">10.3.3.</strong> March</a></li><li class="chapter-item "><a href="../reading/2018/april.html"><strong aria-hidden="true">10.3.4.</strong> April</a></li><li class="chapter-item "><a href="../reading/2018/may.html"><strong aria-hidden="true">10.3.5.</strong> May</a></li><li class="chapter-item "><a href="../reading/2018/june.html"><strong aria-hidden="true">10.3.6.</strong> June</a></li><li class="chapter-item "><a href="../reading/2018/july.html"><strong aria-hidden="true">10.3.7.</strong> July</a></li><li class="chapter-item "><a href="../reading/2018/august.html"><strong aria-hidden="true">10.3.8.</strong> August</a></li><li class="chapter-item "><a href="../reading/2018/september.html"><strong aria-hidden="true">10.3.9.</strong> September</a></li><li class="chapter-item "><a href="../reading/2018/october.html"><strong aria-hidden="true">10.3.10.</strong> October</a></li><li class="chapter-item "><a href="../reading/2018/november.html"><strong aria-hidden="true">10.3.11.</strong> November</a></li><li class="chapter-item "><a href="../reading/2018/december.html"><strong aria-hidden="true">10.3.12.</strong> December</a></li></ol></li><li class="chapter-item "><a href="../reading/2019/index.html"><strong aria-hidden="true">10.4.</strong> 2019</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../reading/2019/january.html"><strong aria-hidden="true">10.4.1.</strong> January</a></li><li class="chapter-item "><a href="../reading/2019/february.html"><strong aria-hidden="true">10.4.2.</strong> February</a></li><li class="chapter-item "><a href="../reading/2019/march.html"><strong aria-hidden="true">10.4.3.</strong> March</a></li><li class="chapter-item "><a href="../reading/2019/april.html"><strong aria-hidden="true">10.4.4.</strong> April</a></li><li class="chapter-item "><a href="../reading/2019/may.html"><strong aria-hidden="true">10.4.5.</strong> May</a></li><li class="chapter-item "><a href="../reading/2019/june.html"><strong aria-hidden="true">10.4.6.</strong> June</a></li><li class="chapter-item "><a href="../reading/2019/july.html"><strong aria-hidden="true">10.4.7.</strong> July</a></li><li class="chapter-item "><a href="../reading/2019/august.html"><strong aria-hidden="true">10.4.8.</strong> August</a></li><li class="chapter-item "><a href="../reading/2019/september.html"><strong aria-hidden="true">10.4.9.</strong> September</a></li><li class="chapter-item "><a href="../reading/2019/october.html"><strong aria-hidden="true">10.4.10.</strong> October</a></li><li class="chapter-item "><a href="../reading/2019/november.html"><strong aria-hidden="true">10.4.11.</strong> November</a></li><li class="chapter-item "><a href="../reading/2019/december.html"><strong aria-hidden="true">10.4.12.</strong> December</a></li></ol></li><li class="chapter-item "><a href="../reading/2020/index.html"><strong aria-hidden="true">10.5.</strong> 2020</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../reading/2020/january.html"><strong aria-hidden="true">10.5.1.</strong> January</a></li><li class="chapter-item "><a href="../reading/2020/february.html"><strong aria-hidden="true">10.5.2.</strong> February</a></li><li class="chapter-item "><a href="../reading/2020/march-june.html"><strong aria-hidden="true">10.5.3.</strong> March—June</a></li><li class="chapter-item "><a href="../reading/2020/july.html"><strong aria-hidden="true">10.5.4.</strong> July</a></li><li class="chapter-item "><a href="../reading/2020/august-december.html"><strong aria-hidden="true">10.5.5.</strong> August—December</a></li></ol></li><li class="chapter-item "><a href="../reading/2021/index.html"><strong aria-hidden="true">10.6.</strong> 2021</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../reading/2021/january-may.html"><strong aria-hidden="true">10.6.1.</strong> First semester</a></li><li class="chapter-item "><a href="../reading/2021/june-november.html"><strong aria-hidden="true">10.6.2.</strong> Second semester</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../deprecated/index.html"><strong aria-hidden="true">11.</strong> Deprecated content</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../deprecated/blanket.html"><strong aria-hidden="true">11.1.</strong> Blanket license</a></li><li class="chapter-item "><div><strong aria-hidden="true">11.2.</strong> Outdated</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../deprecated/outdated/modern-systems-languages.html"><strong aria-hidden="true">11.2.1.</strong> Modern systems languages</a></li><li class="chapter-item "><a href="../deprecated/outdated/soft-limits-meaningful-cuts.html"><strong aria-hidden="true">11.2.2.</strong> Soft limits and meaningful content cuts</a></li><li class="chapter-item "><a href="../deprecated/outdated/bruteforcing-the-devil.html"><strong aria-hidden="true">11.2.3.</strong> Bruteforcing the Devil</a></li><li class="chapter-item "><a href="../deprecated/outdated/lighting-up-rust-with-neon.html"><strong aria-hidden="true">11.2.4.</strong> Lighting up Rust with Neon</a></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">11.3.</strong> Unheld</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../deprecated/unheld/sidebar.html"><strong aria-hidden="true">11.3.1.</strong> SIDEBAR</a></li><li class="chapter-item "><a href="../deprecated/unheld/a-thought-on-fanfiction.html"><strong aria-hidden="true">11.3.2.</strong> A thought on fanfiction</a></li><li class="chapter-item "><div><strong aria-hidden="true">11.3.3.</strong> Indentity</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../deprecated/unheld/not-coming.html"><strong aria-hidden="true">11.3.3.1.</strong> This is not a coming out</a></li><li class="chapter-item "><a href="../deprecated/unheld/guy-adjacent.html"><strong aria-hidden="true">11.3.3.2.</strong> Guy-Adjacent</a></li><li class="chapter-item "><a href="../deprecated/unheld/my-words.html"><strong aria-hidden="true">11.3.3.3.</strong> My Words</a></li><li class="chapter-item "><a href="../deprecated/unheld/check-labels.html"><strong aria-hidden="true">11.3.3.4.</strong> Check all applicable labels</a></li></ol></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Félix Saparelli</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/passcod/blook" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="just-a-bit-of-wasi"><a class="header" href="#just-a-bit-of-wasi">Just a bit of wasi</a></h1>
<blockquote>
<p>July 2022</p>
</blockquote>
<h2 id="background"><a class="header" href="#background">Background</a></h2>
<p>I’ve been working and helping with <a href="https://github.com/ryankurte/cargo-binstall">cargo-binstall</a> a lot recently. We’re
currently discussing <a href="https://github.com/ryankurte/cargo-binstall/issues/246">how to support WASI applications</a>.</p>
<p>As part of this, one idea for detecting if the host (your computer) supports running WASI programs was to make a small
WASI program, embed it in cargo-binstall, and then we can try running it: if it works, WASI runs on your machine, if
there are any errors, we’ll call that a no.</p>
<p>(This means that so far the only way to pass the test is to have an OS which can run WASI programs directly. On Linux,
you can configure that! using <a href="https://en.wikipedia.org/wiki/Binfmt_misc">binfmt_misc</a>. The hope is that other OSes
will eventually get native WASI support, or something like that Linux capability. We discussed having cargo-binstall
handle making a wrapper that calls a WASI runtime, but haven’t yet decided if that’s something we want to do. This is
very fresh! We’re in the middle of it. Join the discussion on the ticket if you have ideas/desires/commentary! 😸)</p>
<p>So: we need to make a small WASI program. Small enough that we can embed it without suffering. Cargo-binstall has
recently had a big push towards both fast compile times and small binary size, and we don’t want to undo that.</p>
<h2 id="hello-world"><a class="header" href="#hello-world">Hello, World!</a></h2>
<p>First idea: start from a <a href="https://bytecodealliance.github.io/cargo-wasi/hello-world.html">Rust WASI Hello World</a> and
optimise from there.</p>
<p>That tutorial goes to install cargo-wasi, but I thought, hmm, I think we can do simpler.</p>
<pre><code class="language-console">$ cargo new hello-wasi
$ cd hello-wasi
$ echo &quot;fn main() {}&quot; &gt; src/main.rs
$ rustup target add wasm32-wasi
$ cargo build --target wasm32-wasi --release
</code></pre>
<p>That’s it! No cargo plugin needed. Let’s see how small that got…</p>
<pre><code class="language-console">$ exa -l target/wasm32-wasi/release/hello-wasi.wasm
.rwxr-xr-x@ 2.0M passcod 26 Jul 19:53 target/wasm32-wasi/release/hello-wasi.wasm
</code></pre>
<p>Gah! Two whole megabytes?!</p>
<p>We could probably optimise this, but it seems like it would be easier to…</p>
<h2 id="start-from-a-smaller-base"><a class="header" href="#start-from-a-smaller-base">Start from a smaller base</a></h2>
<p>How about we get rid of the standard library? That would help, right? Let’s google for
<a href="https://docs.rust-embedded.org/embedonomicon/smallest-no-std.html">smallest no_std program rust</a>…</p>
<pre><code class="language-rust ignore">#![no_std]

use core::panic::PanicInfo;

#[panic_handler]
fn panic(_panic: &amp;PanicInfo&lt;'_&gt;) -&gt; ! {
    loop {}
}
</code></pre>
<p>Ok, a program that does nothing, and does nothing on panic, which it won’t because it does nothing. I’m sure this will
be smaller. Right?</p>
<pre><code class="language-console">$ cargo build --target wasm32-wasi --release
$ exa -l target/wasm32-wasi/release/hello-wasi.wasm
.rwxr-xr-x@ 281 passcod 26 Jul 20:01 target/wasm32-wasi/release/hello-wasi.wasm
</code></pre>
<p>281 BYTES. Ok, now we’re cooking.</p>
<p>So, what does it do when run?</p>
<pre><code class="language-console">$ pacman -S wasmtime
$ wasmtime target/wasm32-wasi/release/hello-wasi.wasm
Error: failed to run main module `target/wasm32-wasi/release/hello-wasi.wasm`

Caused by:
    0: failed to instantiate &quot;target/wasm32-wasi/release/hello-wasi.wasm&quot;
    1: unknown import: `env::__original_main` has not been defined
</code></pre>
<p>Uhhhhh. That’s not good.</p>
<h2 id="maybe-we-do-need-a-main"><a class="header" href="#maybe-we-do-need-a-main">Maybe we do need a main</a></h2>
<p>That program above doesn’t have a <code>fn main()</code>. Maybe that’s what it’s complaining about? Let’s see:</p>
<pre><code class="language-rust ignore">#![no_std]
#![feature(start)]

use core::panic::PanicInfo;

#[panic_handler]
fn panic(_panic: &amp;PanicInfo&lt;'_&gt;) -&gt; ! {
    loop {}
}

#[start]
fn main(_argc: isize, _argv: *const *const u8) -&gt; isize {
    0
}
</code></pre>
<p>That took <a href="https://doc.rust-lang.org/unstable-book/language-features/lang-items.html">a bit to figure out</a>, but we got
there:</p>
<pre><code class="language-console">$ cargo build --target wasm32-wasi --release
   Compiling hello-wasi v0.1.0 (/home/code/rust/hello-wasi)
error[E0554]: `#![feature]` may not be used on the stable release channel
 --&gt; src/main.rs:2:1
  |
2 | #![feature(start)]
  | ^^^^^^^^^^^^^^^^^^

For more information about this error, try `rustc --explain E0554`.
error: could not compile `hello-wasi` due to previous error
</code></pre>
<p>Ah, right:</p>
<pre><code class="language-console">$ cargo +nightly build --target wasm32-wasi --release
   Compiling hello-wasi v0.1.0 (/home/code/rust/hello-wasi)
error[E0463]: can't find crate for `core`
  |
  = note: the `wasm32-wasi` target may not be installed
  = help: consider downloading the target with `rustup target add wasm32-wasi`
  = help: consider building the standard library from source with `cargo build -Zbuild-std`

error[E0463]: can't find crate for `compiler_builtins`

error[E0463]: can't find crate for `core`
 --&gt; src/main.rs:4:5
  |
4 | use core::panic::PanicInfo;
  |     ^^^^ can't find crate
  |
  = note: the `wasm32-wasi` target may not be installed
  = help: consider downloading the target with `rustup target add wasm32-wasi`
  = help: consider building the standard library from source with `cargo build -Zbuild-std`

error: requires `sized` lang_item

For more information about this error, try `rustc --explain E0463`.
error: could not compile `hello-wasi` due to 4 previous errors
</code></pre>
<p>What now? …oh, the target I added earlier was for stable, not for nightly.</p>
<pre><code class="language-console">$ rustup target add --toolchain nightly wasm32-wasi
$ cargo +nightly build --target wasm32-wasi --release
$ wasmtime target/wasm32-wasi/release/hello-wasi.wasm
Error: failed to run main module `target/wasm32-wasi/release/hello-wasi.wasm`

Caused by:
    0: failed to instantiate &quot;target/wasm32-wasi/release/hello-wasi.wasm&quot;
    1: unknown import: `env::exit` has not been defined
</code></pre>
<p>Well, at least that’s a different error <em><strong>I guess</strong></em>.</p>
<h2 id="looking-back"><a class="header" href="#looking-back">Looking back</a></h2>
<p>Wait, we never tested that first program. Does <em>it</em> work?</p>
<pre><code class="language-console">$ cp src/main.rs src/not-working.rs
$ echo &quot;fn main() {}&quot; &gt; src/main.rs
$ cargo build --target wasm32-wasi --release
$ wasmtime target/wasm32-wasi/release/hello-wasi.wasm
$ echo $?
0
</code></pre>
<p>Yep. Sure does.</p>
<h2 id="opening-it-up"><a class="header" href="#opening-it-up">Opening it up</a></h2>
<p>How about we disassemble the WASM into WAST (like “assembly” for other targets) and have a look, maybe we can grep for
these <code>env::exit</code> and <code>env::__original_main</code> to see what they’re defined to in the WASI that works, and if they’re there
in the WASI that doesn’t.</p>
<pre><code class="language-console">$ pacman -S binaryen
$ wasm-dis target/wasm32-wasi/release/hello-wasi.wasm -o wasi-goes.wast

$ cp src/not-working.rs src/main.rs
$ cargo build --target wasm32-wasi --release
$ wasm-dis target/wasm32-wasi/release/hello-wasi.wasm -o wasi-nope.wast
</code></pre>
<pre><code class="language-console">$ rg __original_main wasi-goes.wast -C3
42-   (br_if $label$1
43-    (i32.eqz
44-     (local.tee $0
45:      (call $__original_main)
46-     )
47-    )
48-   )
--
984-  )
985-  (return)
986- )
987: (func $__original_main (result i32)
988-  (local $0 i32)
989-  (local $1 i32)
990-  (local $2 i32)
--
1008- (func $main (param $0 i32) (param $1 i32) (result i32)
1009-  (local $2 i32)
1010-  (local.set $2
1011:   (call $__original_main)
1012-  )
1013-  (return
1014-   (local.get $2)
</code></pre>
<p>Well, it’s definitely in there in the working WASI. Let’s look at the not working one:</p>
<pre><code class="language-console">$ rg __original_main wasi-nope.wast -C3
20-   (br_if $label$1
21-    (i32.eqz
22-     (local.tee $0
23:      (call $__original_main)
24-     )
25-    )
26-   )
--
30-   (unreachable)
31-  )
32- )
33: (func $__original_main (result i32)
34-  (i32.const 0)
35- )
36- (func $main (param $0 i32) (param $1 i32) (result i32)
37:  (call $__original_main)
38- )
39- ;; custom section &quot;producers&quot;, size 28
40-)
</code></pre>
<p>It’s definitely in there too. I guess that makes sense, given the first error went away. What about <code>exit</code>?</p>
<pre><code class="language-console">$ rg exit wasi-goes.wast
22: (import &quot;wasi_snapshot_preview1&quot; &quot;proc_exit&quot; (func $__imported_wasi_snapshot_preview1_proc_exit (param i32)))
49:   (call $exit
24306:  (call $__wasi_proc_exit
24573: (func $__wasi_proc_exit (param $0 i32)
24574:  (call $__imported_wasi_snapshot_preview1_proc_exit
24585: (func $exit (param $0 i32)
</code></pre>
<pre><code class="language-console">$ rg exit wasi-nope.wast
6: (import &quot;env&quot; &quot;exit&quot; (func $exit (param i32)))
27:   (call $exit
</code></pre>
<p>Uhh, well, it’s different, but it does exist on both sides.</p>
<h2 id="or-does-it"><a class="header" href="#or-does-it">Or does it?</a></h2>
<p>Actually, with a bit of squinting, the wasmtime error makes sense! In that <code>wasi-nope.wast</code> program, we “import”
<code>env::exit</code>. And what wasmtime is saying it “nope, I don’t have that available.” But in the <code>wasi-goes.wast</code> program,
we import something else:</p>
<pre><code class="language-wast">(import &quot;wasi_snapshot_preview1&quot; &quot;proc_exit&quot;
  (func $__imported_wasi_snapshot_preview1_proc_exit
    (param i32)))
</code></pre>
<p><em>That</em> looks like it’s part of the WASI API, and wasmtime has no issue providing it.</p>
<h2 id="do-we-even-need-them"><a class="header" href="#do-we-even-need-them">Do we even need them?</a></h2>
<p>Before we get too far, since we have a small program that fits in one screenful in WAST, and we can assemble WAST into
WASM, we can do some quick and dirty experimentation.</p>
<pre><code class="language-wast">(module
 (type $none_=&gt;_i32 (func (result i32)))
 (type $i32_=&gt;_none (func (param i32)))
 (type $none_=&gt;_none (func))
 (import &quot;env&quot; &quot;__original_main&quot; (func $fimport$0 (result i32)))
 (import &quot;env&quot; &quot;exit&quot; (func $fimport$1 (param i32)))
 (global $global$0 i32 (i32.const 1048576))
 (global $global$1 i32 (i32.const 1048576))
 (memory $0 16)
 (export &quot;memory&quot; (memory $0))
 (export &quot;_start&quot; (func $0))
 (export &quot;__data_end&quot; (global $global$0))
 (export &quot;__heap_base&quot; (global $global$1))
 (func $0
  (local $0 i32)
  (if
   (local.tee $0
    (call $fimport$0)
   )
   (block
    (call $fimport$1
     (local.get $0)
    )
    (unreachable)
   )
  )
 )
 ;; custom section &quot;producers&quot;, size 28
)
</code></pre>
<p>Let’s start by removing the <code>__original_main</code> and <code>exit</code> imports, and removing mention of these imports (<code>$fimport$0</code>
and <code>$fimport$1</code>) from what looks like the main function, <code>func $0</code>, at the bottom there:</p>
<pre><code class="language-wast">(module
 (type $none_=&gt;_i32 (func (result i32)))
 (type $i32_=&gt;_none (func (param i32)))
 (type $none_=&gt;_none (func))
 (global $global$0 i32 (i32.const 1048576))
 (global $global$1 i32 (i32.const 1048576))
 (memory $0 16)
 (export &quot;memory&quot; (memory $0))
 (export &quot;_start&quot; (func $0))
 (export &quot;__data_end&quot; (global $global$0))
 (export &quot;__heap_base&quot; (global $global$1))
 (func $0(local $0 i32))
)
</code></pre>
<p>Does that work?</p>
<pre><code class="language-console">$ wasm-as hello-wasi.wast -o wasi-reborn.wasm
$ wasmtime wasi-reborn.wasm
$ echo $?
0
</code></pre>
<p>Whoop! yes it does.</p>
<p>And can we trim that even more?</p>
<pre><code class="language-wast">(module
 (global $global$0 i32 (i32.const 0))
 (global $global$1 i32 (i32.const 0))
 (memory $0 16)
 (export &quot;memory&quot; (memory $0))
 (export &quot;_start&quot; (func $0))
 (export &quot;__data_end&quot; (global $global$0))
 (export &quot;__heap_base&quot; (global $global$1))
 (func $0 (local $0 i32))
)
</code></pre>
<p>We sure can. I got there by carefully removing and tweaking things one at a time, but that’s what I ended up with. So.
How big is that?</p>
<pre><code>$ exa -l wasi-reborn.wasm
.rw-r--r--@ 93 passcod 26 Jul 20:36 wasi-reborn.wasm
</code></pre>
<p>93 bytes. Well, we can call that done, and</p>
<h2 id="is-it-really-wasi-though"><a class="header" href="#is-it-really-wasi-though">Is it really WASI though?</a></h2>
<p>Uhh. Well, I guess not? It’s “just” WASM stuff, no WASI API. So we’d really be testing for a <em>WASM</em> runtime, not WASI.</p>
<p>Hey, we have that exit function import above, there, can we use that?</p>
<pre><code class="language-wast">(module
 (global $global$0 i32 (i32.const 0))
 (global $global$1 i32 (i32.const 0))
 (memory $0 16)
 (export &quot;memory&quot; (memory $0))
 (export &quot;_start&quot; (func $0))
 (export &quot;__data_end&quot; (global $global$0))
 (export &quot;__heap_base&quot; (global $global$1))
 (import &quot;wasi_snapshot_preview1&quot; &quot;proc_exit&quot; (func $exit (param i32)))
 (func $0
  (call $exit (i32.const 0))
  (unreachable)
 )
)
</code></pre>
<pre><code class="language-console">$ wasm-as hello-wasi.wast -o wasi-revolution.wasm
$ wasmtime wasi-revolution.wasm
$ echo $?
0

$ exa -l wasi-revolution.wasm
.rw-r--r--@ 137 passcod 26 Jul 20:43 wasi-revolution.wasm
</code></pre>
<p>Okay! 137 bytes, <em>and</em> we’re calling a WASI import. Sounds good to me.</p>
<h2 id="extra-credit"><a class="header" href="#extra-credit">Extra credit</a></h2>
<p>Do we even need the <code>__data_end</code>, <code>__heap_base</code>, and <code>memory</code>? Let’s try without:</p>
<pre><code class="language-wast">(module
 (export &quot;_start&quot; (func $0))
 (import &quot;wasi_snapshot_preview1&quot; &quot;proc_exit&quot; (func $exit (param i32)))
 (func $0
  (call $exit (i32.const 0))
  (unreachable)
 )
)
</code></pre>
<pre><code>$ wasm-as hello-wasi.wast -o wasi-reprisal.wasm
$ wasmtime wasi-reprisal.wasm
Error: failed to run main module `wasi-reborn.wasm`

Caused by:
    0: failed to invoke command default
    1: missing required memory export
       wasm backtrace:
           0:   0x4f - &lt;unknown&gt;!&lt;wasm function 1&gt;
</code></pre>
<p>That’s a nope on the memory, so let’s restore that:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>(module
 (memory $0 16)
 (export &quot;memory&quot; (memory $0))
 (export &quot;_start&quot; (func $0))
 (import &quot;wasi_snapshot_preview1&quot; &quot;proc_exit&quot; (func $exit (param i32)))
 (func $0
  (call $exit (i32.const 0))
  (unreachable)
 )
)
<span class="boring">}
</span></code></pre></pre>
<pre><code class="language-console">$ wasm-as hello-wasi.wast -o wasi-renewal.wasm
$ wasmtime wasi-renewal.wasm
$ echo $?
0

$ exa -l wasi-renewal.wasm
.rw-r--r--@ 97 passcod 26 Jul 20:43 wasi-renewal.wasm
</code></pre>
<p>Full points for me!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../technical/no-time-for-chrono.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../musings/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../technical/no-time-for-chrono.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../musings/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
