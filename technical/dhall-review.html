<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Dhall: not quite it - Félix Saparelli</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Félix Saparelli</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/passcod/blook" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="dhall-not-quite-it"><a class="header" href="#dhall-not-quite-it">Dhall: not quite it</a></h1>
<blockquote>
<p>8 August 2020</p>
</blockquote>
<p>Last month I dove into <a href="https://dhall-lang.org/">Dhall</a> after discovering it more than a year ago but never having the excuse
to really get stuck into it. Last month I got two different opportunities, and used it for both: an
<a href="https://ubuntu.com/server/docs/install/autoinstall-reference">autoinstall template for Ubuntu 20.04</a>, and a Kubernetes config template for very
similar containers that each needed a pod and a service just to vary one or two settings.</p>
<p>While Dhall is good at what it does, despite many rough edges, as I progressed I realised it’s
really not what I want.</p>
<h2 id="what-dhall-does-well"><a class="header" href="#what-dhall-does-well">What Dhall does well</a></h2>
<p><strong>Types.</strong> Dhall is fully typed in the Haskell fashion, and every Dhall document is an expression,
which contains types or values, or trees of types and trees of values. Dhall does structural typing,
so two types <code>A = { an: Integer }</code> and <code>B = { an: Integer }</code> are actually the <em>same</em> type.</p>
<p><strong>Safety.</strong> Dhall is strictly non-Turing-complete, and most notably is guaranteed to complete (no
halting problem here). Functions have no side effects, and while input can be done from files, the
environment, and remote URLs (!), output is only through whatever structure is left at the end.</p>
<p><strong>Reproducibility.</strong> Dhall includes concepts and tools that can enforce the integrity of imports,
and verify that one expression is equivalent to another, such that you can refactor how that
expression is constructed and authoritatively assert that your refactor is correct.</p>
<p><strong>Library.</strong> As an established project, there are libraries that are built up for various projects,
such as for Kubernetes manifests, Terraform, GitHub actions, OpenSSL, Ansible… additionally, the
built-in function and keyword set is very small, so everything is accessible, inspectable, etc.</p>
<h2 id="where-i-found-it-lacking"><a class="header" href="#where-i-found-it-lacking">Where I found it lacking</a></h2>
<p><strong>Errors.</strong> Good erroring is hard, I’ll acknowledge. Dhall erroring isn’t <em>terrible</em>… but it’s
often obscure and mislaid me many times. Dhall often stops at the first error, which might be a
<em>consequence</em> or a <em>symptom</em> of the actual mistake, and gaining that visiblity is hard.</p>
<p><strong>Familiarity.</strong> and layperson-friendliness. Is basically zero. Dhall errors require familiarity
with Dhall errors: they’re not very approachable unless you’re already familiar with them. Dhall
itself is foreign at times, and some of its syntax quirks are downright baffling (in one pet peeve,
it bills itself as whitespace insensitive, but what it really means is that as long as whitespace is
in the right place, it doesn’t care what that whitespace <em>is</em>… but <code>a(b c)</code> is still different to
<code>a (b c)</code>, to hilariously-hard-to-debug effects.) While I can use Ruby, Rust, and advanced Bash in
work projects, I would <em>never</em> use Dhall because it would add more barriers than it adds value.</p>
<p><strong>Inconsistency.</strong> For a language with a tiny built-in library, it’s quite surprising. Everything in
Dhall is an expression… except some things that look like expressions but aren’t (like the <code>merge</code>
keyword). The whitespace thing. Imports get an optional argument for a checksum, something that
<em>nothing else</em> can do (no optional or default arguments, though the record pattern approximates some
of it). Some things are keywords, some things are symbols, and some things are nothing at all, with
little rhyme or reason. It makes hard to develop intuition.</p>
<p><strong>Information loss.</strong> There’s a bug open for at least three years where the <em>formatting</em> tools of
Dhall will silently erase all comments except those at the top of a file. Dhall is bad at respecting
ordering. This is surprising for a configuration tool: while the consuming application might not
care, order can be very important for <em>humans</em>. Some tools may even interpret ordering, for example
overriding earlier identical keys in a JSON map, or keeping the first one, and re-ordering may
actually change meaning.</p>
<p><strong>Inference.</strong> Because Dhall does structural typing with named and anonymous members, and because it
has no generics, there’s many situations where it <em>knows</em> the type of something, but will refuse to
compile unless you explicit it, which can be very repetitive and/or require refactorings to put a
name on a previously-anonymous type.</p>
<p><strong>Inheritance or extensibility.</strong> While I <em>like</em> the lack of class-based inheritance in
<em>programming</em> languages like Rust and instead embrace the wrapping and trait and composition types
concepts, <em>configuration</em> is a different space. It’s not uncommon for a configuration schema to have
a general shape for a stanza that is specialised in many different variants, and representing that
in Dhall is painful, repetitive, or both.</p>
<p><strong>Translation.</strong> Somewhat related or an alternative to the above. Dhall makes it easy to create
type-friendly structures, but offers little to translate those structures back into what the actual
consumer expects. This ranges from key/value translation, where a Dhall-idiomatic spelling would be
<code>StorageKind</code> but the configuration requires <code>storage-kind</code>, to flattening, where you could express
a structure as a <code>Action&lt;Specifics&gt;</code> where <code>Action</code> has a type and id, and <code>Specifics</code> is an
enum/union for <code>AddPartition</code> or <code>WriteFilesystem</code> but the required structure has type and ids and
all specific properties on the same level, to different translations for different outputs.</p>
<p><strong>Postel’s Law.</strong> Or robustness principle. The one that goes “Be conservative in what you do, be
liberal in what you accept from others.” Dhall is conservative in what it does, certainly, and also
very strict in what it accepts. This would not be so much a problem if the tooling/erroring was
better: JSON can also be said to be strict on the input, and tooling exists that will point to where
the error is quite precisely; YAML can be said to be quite lax, and may silently do the wrong thing.
Dhall, however, doesn’t improve one way or the other.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../technical/no-time-for-chrono.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../deprecated/outdated/modern-systems-languages.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../technical/no-time-for-chrono.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../deprecated/outdated/modern-systems-languages.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
