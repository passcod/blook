<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>2021 | Rust crimes: Enum ints - Félix Saparelli</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../intro.html"><strong aria-hidden="true">1.</strong> Introduction</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../avatars/index.html"><strong aria-hidden="true">1.1.</strong> Avatars</a></li><li class="chapter-item "><a href="../info/index.html"><strong aria-hidden="true">1.2.</strong> Pronouns</a></li><li class="chapter-item "><a href="../info/trademark.html"><strong aria-hidden="true">1.3.</strong> Trademark</a></li></ol></li><li class="chapter-item expanded "><a href="../technical/index.html"><strong aria-hidden="true">2.</strong> Technicals</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../technical/g7-7700-nouveau.html"><strong aria-hidden="true">2.1.</strong> 2024 | Nouveau on Dell G7 7700</a></li><li class="chapter-item "><a href="../technical/caddy.html"><strong aria-hidden="true">2.2.</strong> 2023 | Caddy</a></li><li class="chapter-item "><a href="../technical/starlink.html"><strong aria-hidden="true">2.3.</strong> 2023 | IPv6 on Mikrotik on Starlink</a></li><li class="chapter-item "><a href="../technical/just-a-bit-of-wasi.html"><strong aria-hidden="true">2.4.</strong> 2022 | Just a bit of wasi</a></li><li class="chapter-item expanded "><a href="../technical/rust-crimes-enum-ints.html" class="active"><strong aria-hidden="true">2.5.</strong> 2021 | Rust crimes: Enum ints</a></li><li class="chapter-item "><a href="../technical/exploring-wasm.html"><strong aria-hidden="true">2.6.</strong> 2020 | Exploration of Wasm</a></li><li class="chapter-item "><a href="../technical/async-generator-state-machine.html"><strong aria-hidden="true">2.7.</strong> 2018 | A little elegant state machine with Async Generators</a></li></ol></li><li class="chapter-item expanded "><a href="../musings/index.html"><strong aria-hidden="true">3.</strong> Musings</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../musings/ai.html"><strong aria-hidden="true">3.1.</strong> On generative AI for programming Rust</a></li><li class="chapter-item "><a href="../musings/progression-of-designs.html"><strong aria-hidden="true">3.2.</strong> A progression of designs</a></li><li class="chapter-item "><a href="../musings/gaston-lagaffe/index.html"><strong aria-hidden="true">3.3.</strong> Gaston Lagaffe</a></li><li class="chapter-item "><a href="../musings/known-unknowns-conflang.html"><strong aria-hidden="true">3.4.</strong> Known Unknowns: a configuration language</a></li><li class="chapter-item "><a href="../musings/on-the-difficulty-of-automated-unblocking.html"><strong aria-hidden="true">3.5.</strong> On the difficulty of automated unblocking</a></li><li class="chapter-item "><a href="../musings/on-invoking-deities.html"><strong aria-hidden="true">3.6.</strong> On Invoking Deities</a></li></ol></li><li class="chapter-item expanded "><a href="../models/index.html"><strong aria-hidden="true">4.</strong> 3D Models</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../models/wall-plant-pots/index.html"><strong aria-hidden="true">4.1.</strong> Wall Plant Pots</a></li><li class="chapter-item "><a href="../models/mijia-hang/index.html"><strong aria-hidden="true">4.2.</strong> Mijia Hang</a></li><li class="chapter-item "><a href="../models/filabox/index.html"><strong aria-hidden="true">4.3.</strong> Filabox</a></li></ol></li><li class="chapter-item expanded "><a href="../fiction/index.html"><strong aria-hidden="true">5.</strong> Fiction</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../fiction/poetry/index.html"><strong aria-hidden="true">5.1.</strong> Poetry</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../fiction/poetry/only-one-left.html"><strong aria-hidden="true">5.1.1.</strong> Only One Left</a></li><li class="chapter-item "><a href="../fiction/poetry/mid-loss.html"><strong aria-hidden="true">5.1.2.</strong> Mid-loss</a></li><li class="chapter-item "><a href="../fiction/poetry/aftermath.html"><strong aria-hidden="true">5.1.3.</strong> Aftermath</a></li><li class="chapter-item "><a href="../fiction/poetry/one-and-two.html"><strong aria-hidden="true">5.1.4.</strong> one and two</a></li><li class="chapter-item "><a href="../fiction/poetry/grow.html"><strong aria-hidden="true">5.1.5.</strong> Grow</a></li><li class="chapter-item "><a href="../fiction/poetry/slowly.html"><strong aria-hidden="true">5.1.6.</strong> Slowly</a></li><li class="chapter-item "><a href="../fiction/poetry/alya.html"><strong aria-hidden="true">5.1.7.</strong> Alya</a></li><li class="chapter-item "><a href="../fiction/poetry/so-many-alone-at-night.html"><strong aria-hidden="true">5.1.8.</strong> so many alone at night</a></li><li class="chapter-item "><a href="../fiction/poetry/up-up-and-away.html"><strong aria-hidden="true">5.1.9.</strong> Up Up And Away</a></li><li class="chapter-item "><a href="../fiction/poetry/sleep.html"><strong aria-hidden="true">5.1.10.</strong> Sleep</a></li><li class="chapter-item "><a href="../fiction/poetry/hold.html"><strong aria-hidden="true">5.1.11.</strong> Hold</a></li><li class="chapter-item "><a href="../fiction/poetry/sorry.html"><strong aria-hidden="true">5.1.12.</strong> Sorry</a></li><li class="chapter-item "><a href="../fiction/poetry/right-over-there.html"><strong aria-hidden="true">5.1.13.</strong> Right over there</a></li><li class="chapter-item "><a href="../fiction/poetry/the-road-to-hell.html"><strong aria-hidden="true">5.1.14.</strong> The Road to Hell</a></li><li class="chapter-item "><a href="../fiction/poetry/self.html"><strong aria-hidden="true">5.1.15.</strong> Self</a></li><li class="chapter-item "><a href="../fiction/poetry/tree.html"><strong aria-hidden="true">5.1.16.</strong> Tree</a></li><li class="chapter-item "><a href="../fiction/poetry/unlit.html"><strong aria-hidden="true">5.1.17.</strong> Unlit</a></li><li class="chapter-item "><a href="../fiction/poetry/one-summer-morning.html"><strong aria-hidden="true">5.1.18.</strong> One summer morning</a></li><li class="chapter-item "><a href="../fiction/poetry/smile.html"><strong aria-hidden="true">5.1.19.</strong> Smile</a></li></ol></li><li class="chapter-item "><a href="../fiction/shorts/index.html"><strong aria-hidden="true">5.2.</strong> Short Prose</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../fiction/shorts/the-box.html"><strong aria-hidden="true">5.2.1.</strong> The Box</a></li><li class="chapter-item "><a href="../fiction/shorts/a-man.html"><strong aria-hidden="true">5.2.2.</strong> A Man</a></li><li class="chapter-item "><a href="../fiction/shorts/alive-in-the-night.html"><strong aria-hidden="true">5.2.3.</strong> ali.vei.nth.eni.ght</a></li><li class="chapter-item "><a href="../fiction/shorts/regulus.html"><strong aria-hidden="true">5.2.4.</strong> Regulus</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../fiction/shorts/regulus-notes.html"><strong aria-hidden="true">5.2.4.1.</strong> (notes for) Regulus</a></li></ol></li><li class="chapter-item "><a href="../fiction/shorts/my-mountain-of-knowledge.html"><strong aria-hidden="true">5.2.5.</strong> My mountain of Knowledge</a></li><li class="chapter-item "><a href="../fiction/shorts/finally-i-knew.html"><strong aria-hidden="true">5.2.6.</strong> Finally, I knew</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../recipes/index.html"><strong aria-hidden="true">6.</strong> Recipes</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../recipes/blue-orange.html"><strong aria-hidden="true">6.1.</strong> Blue Orange Cocktail</a></li><li class="chapter-item "><a href="../recipes/thermomix/dairy-cream.html"><strong aria-hidden="true">6.2.</strong> No-effort Dairy Cream</a></li><li class="chapter-item "><a href="../recipes/thermomix/pasta.html"><strong aria-hidden="true">6.3.</strong> Semi-steamed Pasta</a></li></ol></li><li class="chapter-item expanded "><a href="../updates/index.html"><strong aria-hidden="true">7.</strong> Progress updates</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../updates/projects/sassbot.html"><strong aria-hidden="true">7.1.</strong> Sassbot</a></li><li class="chapter-item "><a href="../updates/projects/spanish.html"><strong aria-hidden="true">7.2.</strong> Spanish</a></li><li class="chapter-item "><a href="../updates/projects/super.html"><strong aria-hidden="true">7.3.</strong> Super</a></li><li class="chapter-item "><a href="../updates/projects/cargo-watchexec.html"><strong aria-hidden="true">7.4.</strong> Watchexec</a></li><li class="chapter-item "><div><strong aria-hidden="true">7.5.</strong> Archived</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../updates/projects/accord.html"><strong aria-hidden="true">7.5.1.</strong> Accord</a></li><li class="chapter-item "><a href="../technical/agile/index.html"><strong aria-hidden="true">7.5.2.</strong> AGILE</a></li><li class="chapter-item "><a href="../updates/projects/armstrong.html"><strong aria-hidden="true">7.5.3.</strong> Armstrong</a></li><li class="chapter-item "><a href="../updates/projects/caretaker.html"><strong aria-hidden="true">7.5.4.</strong> Caretaker</a></li><li class="chapter-item "><a href="../updates/projects/car-rainbow.html"><strong aria-hidden="true">7.5.5.</strong> Car Rainbow</a></li><li class="chapter-item "><a href="../updates/projects/certainly.html"><strong aria-hidden="true">7.5.6.</strong> Certainly</a></li><li class="chapter-item "><a href="../updates/projects/ct.html"><strong aria-hidden="true">7.5.7.</strong> ct</a></li><li class="chapter-item "><a href="../updates/projects/defnew.html"><strong aria-hidden="true">7.5.8.</strong> defnew</a></li><li class="chapter-item "><a href="../updates/projects/eqsky.html"><strong aria-hidden="true">7.5.9.</strong> Earthquake Sky</a></li><li class="chapter-item "><a href="../updates/projects/figleaf.html"><strong aria-hidden="true">7.5.10.</strong> Figleaf</a></li><li class="chapter-item "><a href="../updates/projects/glass-hanger.html"><strong aria-hidden="true">7.5.11.</strong> Glass Hanger</a></li><li class="chapter-item "><a href="../updates/projects/entry-insert.html"><strong aria-hidden="true">7.5.12.</strong> Hashmap Entry Insert</a></li><li class="chapter-item "><a href="../updates/projects/intpath.html"><strong aria-hidden="true">7.5.13.</strong> IntPath</a></li><li class="chapter-item "><a href="../updates/projects/irish.html"><strong aria-hidden="true">7.5.14.</strong> Irish</a></li><li class="chapter-item "><a href="../updates/projects/japanese.html"><strong aria-hidden="true">7.5.15.</strong> Japanese</a></li><li class="chapter-item "><a href="../updates/projects/keycasting.html"><strong aria-hidden="true">7.5.16.</strong> Keycasting</a></li><li class="chapter-item "><a href="../updates/projects/lah-kara.html"><strong aria-hidden="true">7.5.17.</strong> Lah Kara</a></li><li class="chapter-item "><a href="../updates/projects/mead.html"><strong aria-hidden="true">7.5.18.</strong> Mead</a></li><li class="chapter-item "><a href="../updates/projects/notify.html"><strong aria-hidden="true">7.5.19.</strong> Notify</a></li><li class="chapter-item "><a href="../updates/projects/omelette.html"><strong aria-hidden="true">7.5.20.</strong> Omelette</a></li><li class="chapter-item "><a href="../updates/projects/pinn.html"><strong aria-hidden="true">7.5.21.</strong> Pinn</a></li><li class="chapter-item "><a href="../updates/projects/reasonable.html"><strong aria-hidden="true">7.5.22.</strong> Reasonable</a></li><li class="chapter-item "><a href="../updates/projects/reupholstery.html"><strong aria-hidden="true">7.5.23.</strong> Reupholstering chairs</a></li><li class="chapter-item "><a href="../updates/projects/splash.html"><strong aria-hidden="true">7.5.24.</strong> Splash</a></li><li class="chapter-item "><a href="../updates/projects/storq.html"><strong aria-hidden="true">7.5.25.</strong> Storq</a></li><li class="chapter-item "><a href="../updates/projects/swp.html"><strong aria-hidden="true">7.5.26.</strong> Swp</a></li><li class="chapter-item "><a href="../updates/projects/trebuchet.html"><strong aria-hidden="true">7.5.27.</strong> Trebuchet</a></li><li class="chapter-item "><a href="../updates/projects/what.html"><strong aria-hidden="true">7.5.28.</strong> What</a></li><li class="chapter-item "><a href="../updates/projects/zarc.html"><strong aria-hidden="true">7.5.29.</strong> Zarc</a></li></ol></li><li class="chapter-item "><a href="../updates/dated/index.html"><strong aria-hidden="true">7.6.</strong> 2017-2019 (mostly) regular micro updates</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../updates/dated/2016.html"><strong aria-hidden="true">7.6.1.</strong> 2016</a></li><li class="chapter-item "><a href="../updates/dated/2017/index.html"><strong aria-hidden="true">7.6.2.</strong> 2017</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../updates/dated/2017/january.html"><strong aria-hidden="true">7.6.2.1.</strong> January</a></li><li class="chapter-item "><a href="../updates/dated/2017/february.html"><strong aria-hidden="true">7.6.2.2.</strong> February</a></li><li class="chapter-item "><a href="../updates/dated/2017/march.html"><strong aria-hidden="true">7.6.2.3.</strong> March</a></li><li class="chapter-item "><a href="../updates/dated/2017/april.html"><strong aria-hidden="true">7.6.2.4.</strong> April</a></li><li class="chapter-item "><a href="../updates/dated/2017/may.html"><strong aria-hidden="true">7.6.2.5.</strong> May</a></li><li class="chapter-item "><a href="../updates/dated/2017/june.html"><strong aria-hidden="true">7.6.2.6.</strong> June</a></li><li class="chapter-item "><a href="../updates/dated/2017/july.html"><strong aria-hidden="true">7.6.2.7.</strong> July</a></li><li class="chapter-item "><a href="../updates/dated/2017/august.html"><strong aria-hidden="true">7.6.2.8.</strong> August</a></li><li class="chapter-item "><a href="../updates/dated/2017/september.html"><strong aria-hidden="true">7.6.2.9.</strong> September</a></li><li class="chapter-item "><a href="../updates/dated/2017/october.html"><strong aria-hidden="true">7.6.2.10.</strong> October</a></li><li class="chapter-item "><a href="../updates/dated/2017/november.html"><strong aria-hidden="true">7.6.2.11.</strong> November</a></li><li class="chapter-item "><a href="../updates/dated/2017/december.html"><strong aria-hidden="true">7.6.2.12.</strong> December</a></li></ol></li><li class="chapter-item "><a href="../updates/dated/2018/index.html"><strong aria-hidden="true">7.6.3.</strong> 2018</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../updates/dated/2018/january.html"><strong aria-hidden="true">7.6.3.1.</strong> January</a></li><li class="chapter-item "><a href="../updates/dated/2018/march.html"><strong aria-hidden="true">7.6.3.2.</strong> March</a></li><li class="chapter-item "><a href="../updates/dated/2018/april.html"><strong aria-hidden="true">7.6.3.3.</strong> April</a></li><li class="chapter-item "><a href="../updates/dated/2018/may.html"><strong aria-hidden="true">7.6.3.4.</strong> May</a></li><li class="chapter-item "><a href="../updates/dated/2018/september.html"><strong aria-hidden="true">7.6.3.5.</strong> September</a></li><li class="chapter-item "><a href="../updates/dated/2018/november.html"><strong aria-hidden="true">7.6.3.6.</strong> November</a></li><li class="chapter-item "><a href="../updates/dated/2018/december.html"><strong aria-hidden="true">7.6.3.7.</strong> December</a></li></ol></li><li class="chapter-item "><a href="../updates/dated/2019/index.html"><strong aria-hidden="true">7.6.4.</strong> 2019</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../updates/dated/2019/january.html"><strong aria-hidden="true">7.6.4.1.</strong> January</a></li><li class="chapter-item "><a href="../updates/dated/2019/february.html"><strong aria-hidden="true">7.6.4.2.</strong> February</a></li><li class="chapter-item "><a href="../updates/dated/2019/march.html"><strong aria-hidden="true">7.6.4.3.</strong> March</a></li><li class="chapter-item "><a href="../updates/dated/2019/april.html"><strong aria-hidden="true">7.6.4.4.</strong> April</a></li><li class="chapter-item "><a href="../updates/dated/2019/september.html"><strong aria-hidden="true">7.6.4.5.</strong> September</a></li><li class="chapter-item "><a href="../updates/dated/2019/december.html"><strong aria-hidden="true">7.6.4.6.</strong> December</a></li></ol></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../reading/index.html"><strong aria-hidden="true">8.</strong> Reading archive</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../reading/2016/index.html"><strong aria-hidden="true">8.1.</strong> 2016</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../reading/2016/july.html"><strong aria-hidden="true">8.1.1.</strong> July</a></li><li class="chapter-item "><a href="../reading/2016/december.html"><strong aria-hidden="true">8.1.2.</strong> December</a></li></ol></li><li class="chapter-item "><a href="../reading/2017/index.html"><strong aria-hidden="true">8.2.</strong> 2017</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../reading/2017/january.html"><strong aria-hidden="true">8.2.1.</strong> January</a></li><li class="chapter-item "><a href="../reading/2017/february.html"><strong aria-hidden="true">8.2.2.</strong> February</a></li><li class="chapter-item "><a href="../reading/2017/march.html"><strong aria-hidden="true">8.2.3.</strong> March</a></li><li class="chapter-item "><a href="../reading/2017/april.html"><strong aria-hidden="true">8.2.4.</strong> April</a></li><li class="chapter-item "><a href="../reading/2017/may.html"><strong aria-hidden="true">8.2.5.</strong> May</a></li><li class="chapter-item "><a href="../reading/2017/june.html"><strong aria-hidden="true">8.2.6.</strong> June</a></li><li class="chapter-item "><a href="../reading/2017/july.html"><strong aria-hidden="true">8.2.7.</strong> July</a></li><li class="chapter-item "><a href="../reading/2017/august.html"><strong aria-hidden="true">8.2.8.</strong> August</a></li><li class="chapter-item "><a href="../reading/2017/september.html"><strong aria-hidden="true">8.2.9.</strong> September</a></li><li class="chapter-item "><a href="../reading/2017/october.html"><strong aria-hidden="true">8.2.10.</strong> October</a></li><li class="chapter-item "><a href="../reading/2017/november.html"><strong aria-hidden="true">8.2.11.</strong> November</a></li><li class="chapter-item "><a href="../reading/2017/december.html"><strong aria-hidden="true">8.2.12.</strong> December</a></li></ol></li><li class="chapter-item "><a href="../reading/2018/index.html"><strong aria-hidden="true">8.3.</strong> 2018</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../reading/2018/january.html"><strong aria-hidden="true">8.3.1.</strong> January</a></li><li class="chapter-item "><a href="../reading/2018/february.html"><strong aria-hidden="true">8.3.2.</strong> February</a></li><li class="chapter-item "><a href="../reading/2018/march.html"><strong aria-hidden="true">8.3.3.</strong> March</a></li><li class="chapter-item "><a href="../reading/2018/april.html"><strong aria-hidden="true">8.3.4.</strong> April</a></li><li class="chapter-item "><a href="../reading/2018/may.html"><strong aria-hidden="true">8.3.5.</strong> May</a></li><li class="chapter-item "><a href="../reading/2018/june.html"><strong aria-hidden="true">8.3.6.</strong> June</a></li><li class="chapter-item "><a href="../reading/2018/july.html"><strong aria-hidden="true">8.3.7.</strong> July</a></li><li class="chapter-item "><a href="../reading/2018/august.html"><strong aria-hidden="true">8.3.8.</strong> August</a></li><li class="chapter-item "><a href="../reading/2018/september.html"><strong aria-hidden="true">8.3.9.</strong> September</a></li><li class="chapter-item "><a href="../reading/2018/october.html"><strong aria-hidden="true">8.3.10.</strong> October</a></li><li class="chapter-item "><a href="../reading/2018/november.html"><strong aria-hidden="true">8.3.11.</strong> November</a></li><li class="chapter-item "><a href="../reading/2018/december.html"><strong aria-hidden="true">8.3.12.</strong> December</a></li></ol></li><li class="chapter-item "><a href="../reading/2019/index.html"><strong aria-hidden="true">8.4.</strong> 2019</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../reading/2019/january.html"><strong aria-hidden="true">8.4.1.</strong> January</a></li><li class="chapter-item "><a href="../reading/2019/february.html"><strong aria-hidden="true">8.4.2.</strong> February</a></li><li class="chapter-item "><a href="../reading/2019/march.html"><strong aria-hidden="true">8.4.3.</strong> March</a></li><li class="chapter-item "><a href="../reading/2019/april.html"><strong aria-hidden="true">8.4.4.</strong> April</a></li><li class="chapter-item "><a href="../reading/2019/may.html"><strong aria-hidden="true">8.4.5.</strong> May</a></li><li class="chapter-item "><a href="../reading/2019/june.html"><strong aria-hidden="true">8.4.6.</strong> June</a></li><li class="chapter-item "><a href="../reading/2019/july.html"><strong aria-hidden="true">8.4.7.</strong> July</a></li><li class="chapter-item "><a href="../reading/2019/august.html"><strong aria-hidden="true">8.4.8.</strong> August</a></li><li class="chapter-item "><a href="../reading/2019/september.html"><strong aria-hidden="true">8.4.9.</strong> September</a></li><li class="chapter-item "><a href="../reading/2019/october.html"><strong aria-hidden="true">8.4.10.</strong> October</a></li><li class="chapter-item "><a href="../reading/2019/november.html"><strong aria-hidden="true">8.4.11.</strong> November</a></li><li class="chapter-item "><a href="../reading/2019/december.html"><strong aria-hidden="true">8.4.12.</strong> December</a></li></ol></li><li class="chapter-item "><a href="../reading/2020/index.html"><strong aria-hidden="true">8.5.</strong> 2020</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../reading/2020/january.html"><strong aria-hidden="true">8.5.1.</strong> January</a></li><li class="chapter-item "><a href="../reading/2020/february.html"><strong aria-hidden="true">8.5.2.</strong> February</a></li><li class="chapter-item "><a href="../reading/2020/march-june.html"><strong aria-hidden="true">8.5.3.</strong> March—June</a></li><li class="chapter-item "><a href="../reading/2020/july.html"><strong aria-hidden="true">8.5.4.</strong> July</a></li><li class="chapter-item "><a href="../reading/2020/august-december.html"><strong aria-hidden="true">8.5.5.</strong> August—December</a></li></ol></li><li class="chapter-item "><a href="../reading/2021/index.html"><strong aria-hidden="true">8.6.</strong> 2021</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../reading/2021/january-may.html"><strong aria-hidden="true">8.6.1.</strong> First semester</a></li><li class="chapter-item "><a href="../reading/2021/june-november.html"><strong aria-hidden="true">8.6.2.</strong> Second semester</a></li></ol></li><li class="chapter-item "><a href="../reading/2022/index.html"><strong aria-hidden="true">8.7.</strong> 2022</a></li><li class="chapter-item "><a href="../reading/2023/index.html"><strong aria-hidden="true">8.8.</strong> 2023</a></li><li class="chapter-item "><a href="../reading/2024/index.html"><strong aria-hidden="true">8.9.</strong> 2024</a></li></ol></li><li class="chapter-item expanded "><a href="../deprecated/index.html"><strong aria-hidden="true">9.</strong> Deprecated content</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../deprecated/blanket.html"><strong aria-hidden="true">9.1.</strong> Blanket license</a></li><li class="chapter-item "><a href="../info/keys.html"><strong aria-hidden="true">9.2.</strong> Cryptographic keys</a></li><li class="chapter-item "><div><strong aria-hidden="true">9.3.</strong> Outdated</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../technical/no-time-for-chrono.html"><strong aria-hidden="true">9.3.1.</strong> No Time for Chrono</a></li><li class="chapter-item "><a href="../technical/dhall-review.html"><strong aria-hidden="true">9.3.2.</strong> Dhall: not quite it</a></li><li class="chapter-item "><a href="../deprecated/outdated/modern-systems-languages.html"><strong aria-hidden="true">9.3.3.</strong> Modern systems languages</a></li><li class="chapter-item "><a href="../deprecated/outdated/soft-limits-meaningful-cuts.html"><strong aria-hidden="true">9.3.4.</strong> Soft limits and meaningful content cuts</a></li><li class="chapter-item "><a href="../deprecated/outdated/bruteforcing-the-devil.html"><strong aria-hidden="true">9.3.5.</strong> Bruteforcing the Devil</a></li><li class="chapter-item "><a href="../deprecated/outdated/lighting-up-rust-with-neon.html"><strong aria-hidden="true">9.3.6.</strong> Lighting up Rust with Neon</a></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">9.4.</strong> Unheld</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../deprecated/unheld/sidebar.html"><strong aria-hidden="true">9.4.1.</strong> SIDEBAR</a></li><li class="chapter-item "><a href="../deprecated/unheld/a-thought-on-fanfiction.html"><strong aria-hidden="true">9.4.2.</strong> A thought on fanfiction</a></li><li class="chapter-item "><div><strong aria-hidden="true">9.4.3.</strong> Identity</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../deprecated/unheld/not-coming.html"><strong aria-hidden="true">9.4.3.1.</strong> This is not a coming out</a></li><li class="chapter-item "><a href="../deprecated/unheld/guy-adjacent.html"><strong aria-hidden="true">9.4.3.2.</strong> Guy-Adjacent</a></li><li class="chapter-item "><a href="../deprecated/unheld/my-words.html"><strong aria-hidden="true">9.4.3.3.</strong> My Words</a></li><li class="chapter-item "><a href="../deprecated/unheld/check-labels.html"><strong aria-hidden="true">9.4.3.4.</strong> Check all applicable labels</a></li></ol></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Félix Saparelli</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/passcod/blook" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="rust-crimes-enum-ints"><a class="header" href="#rust-crimes-enum-ints">Rust crimes: Enum ints</a></h1>
<blockquote>
<p>October 2021</p>
</blockquote>
<ol>
<li>
<blockquote>
<p>cursed thought: rust enums are expressive enough that you dont really need “built in” types. you can express everything with just enums…</p>
</blockquote>
<p>~<a href="https://twitter.com/EllenNyan0214/status/1443349026624126979">Boxy</a></p>
</li>
<li>
<blockquote>
<p>does this mean u8 can move to a crate?</p>
</blockquote>
<p>~<a href="https://twitter.com/thingskatedid/status/1443442125002080257">Kate</a></p>
</li>
<li>
<blockquote>
<p>Please Kate, this is my worst nightmare. I have dependency minimization brain along with use-the-smalleet-int-possible brain. They are terminal and often co-morbid.</p>
</blockquote>
<p>~<a href="https://twitter.com/gennyble/status/1443444518758621188">genny</a> <em>(tweet since deleted)</em></p>
</li>
<li>
<blockquote>
<p>dw we can’t actually do this as there’s no way to disambiguate the values.</p>
</blockquote>
<p>~<a href="https://twitter.com/workingjubilee/status/1443449846501765126">jubilee</a></p>
</li>
</ol>
<p>Okay, so, what does this mean?</p>
<p>Well, in Rust you can wildcard import names into your scope:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::sync::atomic::*;

let a = AtomicU8::new(0);
a.store(1, Ordering::Relaxed);
<span class="boring">}</span></code></pre></pre>
<p>And sometimes different things have the same name:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::cmp::*;

assert_eq!(
    max(1, 2).cmp(&amp;3),
    Ordering::Less
);
<span class="boring">}</span></code></pre></pre>
<p>So if you try to wildcard import names where there’s an overlap…</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused_imports)]
</span>use std::sync::atomic::*;
use std::cmp::*;
<span class="boring">fn main () {}</span></code></pre></pre>
<pre><code class="language-text">$ rustc wild.rs

[Exit: 0]
</code></pre>
<p>Huh.</p>
<p>Oh, right, you have to actually use something that’s ambiguous:</p>
<pre><code class="language-rust ignore"><span class="boring">#![allow(unused_imports)]
</span>use std::sync::atomic::*;
use std::cmp::*;

<span class="boring">fn main () {
</span>dbg!(Ordering::Relaxed);
<span class="boring">}</span></code></pre>
<p>And now you get an error:</p>
<pre><code class="language-text">$ rustc wild.rs

error[E0659]: `Ordering` is ambiguous (glob import vs glob import in the same module)
 --&gt; wild.rs:7:8
  |
7 |   dbg!(Ordering::Relaxed);
  |        ^^^^^^^^ ambiguous name
  |
note: `Ordering` could refer to the enum imported here
 --&gt; wild.rs:3:5
  |
3 | use std::sync::atomic::*;
  |     ^^^^^^^^^^^^^^^^^^^^
  = help: consider adding an explicit import of `Ordering` to disambiguate
note: `Ordering` could also refer to the enum imported here
 --&gt; wild.rs:4:5
  |
4 | use std::cmp::*;
  |     ^^^^^^^^^^^
  = help: consider adding an explicit import of `Ordering` to disambiguate

error: aborting due to previous error

For more information about this error, try `rustc --explain E0659`.

[Exit: 1]
</code></pre>
<p>So, if you were to try to make integers be an external crate that you wildcard-imported into the
scope, which could potentially look like this:</p>
<pre><code class="language-rust ignore">use ints::u8::*;
<span class="boring">fn main () {
</span>assert_eq!(1 + 2, 3);
<span class="boring">}</span></code></pre>
<p>That would work, but as soon as you try to use multiple integer widths:</p>
<pre><code class="language-rust ignore">use ints::u8::*;
use ints::u16::*;
<span class="boring">fn main () {
</span>assert_eq!(1 + 2, 3);
<span class="boring">}</span></code></pre>
<p>You’d run into issues, because both <code>ints::u8</code> and <code>ints::u16</code> contain 1, 2, 3…</p>
<p>Also, currently integer primives in Rust would totally clash:</p>
<pre><code class="language-rust ignore">use u2::*;
enum u2 { 0, 1, 2, 3 }
<span class="boring">fn main () {
</span>assert_eq!(0, 0);
<span class="boring">}</span></code></pre>
<pre><code class="language-text">$ rustc nothing-suspicious-here.rs
error: expected identifier, found `0`
 --&gt; nothing-suspicious-here.rs:3:11
  |
3 | enum u2 { 0, 1, 2, 3 }
  |           ^ expected identifier

error: aborting due to previous error

[Exit: 1]
</code></pre>
<p>Right, it doesn’t even let us out of the gate, because identifiers cannot be digits.</p>
<p>Hmm, maybe we can add an innocent-looking suffix there to bypass that silly restriction?</p>
<pre><code class="language-rust ignore">use u2::*;
enum u2 { 0_u2, 1_u2, 2_u2, 3_u2 }
<span class="boring">fn main () {
</span>assert_eq!(0_u2, 0_u2);
<span class="boring">}</span></code></pre>
<pre><code class="language-text">$ rustc nothing-suspicious-here.rs
error: expected identifier, found `0_u2`
 --&gt; nothing-suspicious-here.rs:3:11
  |
3 | enum u2 { 0_u2, 1_u2, 2_u2, 3_u2 }
  |           ^^^^ expected identifier

error: aborting due to previous error
</code></pre>
<p>Denied.</p>
<p>Looks like we can’t do it.</p>
<hr />
<p>But what if we wanted to look as if we’d side-stepped the issue and made crated integers work?</p>
<p>Well, first we need to figure out this identifier thing. Who even decides what identifiers can look
like?!</p>
<p>The <a href="https://doc.rust-lang.org/reference/identifiers.html">Rust Reference</a> does:</p>
<blockquote>
<p>An identifier is any nonempty Unicode string of the following form:</p>
<p>Either</p>
<ul>
<li>The first character has property <a href="http://unicode.org/cldr/utility/list-unicodeset.jsp?a=%5B%3AXID_Start%3A%5D&amp;abb=on&amp;g=&amp;i="><code>XID_start</code></a>.</li>
<li>The remaining characters have property <a href="http://unicode.org/cldr/utility/list-unicodeset.jsp?a=%5B%3AXID_Continue%3A%5D&amp;abb=on&amp;g=&amp;i="><code>XID_continue</code></a>.</li>
</ul>
</blockquote>
<p>Alright. So there’s a restricted set of Unicode characters that can <em>start</em> an identifier, and
numbers aren’t in that set. But can we find something discreet enough that <em>is</em> <code>XID_Start</code>?</p>
<p>Why yes. Yes we can:</p>
<p>Enter the <a href="https://util.unicode.org/UnicodeJsps/character.jsp?a=FFA0">Halfwidth Hangul Filler</a>.
This character is <code>XID_Start</code>, and (provided you have Hangul fonts) renders as…  either a blank
space, or nothing at all.</p>
<p>Does it work?</p>
<pre><pre class="playground"><code class="language-rust">#[derive(Debug)]
enum Foo { ﾠBar }

<span class="boring">fn main () {
</span>println!("{:?}", format!("{:?}", Foo::ﾠBar));
println!("{:?}", format!("{:?}", Foo::ﾠBar).as_bytes());
<span class="boring">}</span></code></pre></pre>
<pre><code class="language-text">$ rustc notacrime.rs
warning: identifier contains uncommon Unicode codepoints
 --&gt; notacrime.rs:5:12
  |
5 | enum Foo { ﾠBar }
  |            ^^^^
  |
  = note: `#[warn(uncommon_codepoints)]` on by default

warning: 1 warning emitted

[Exit: 0]

$ ./notacrime
"ﾠBar"
[239, 190, 160, 66, 97, 114]

[Exit: 0]
</code></pre>
<p>Right, first, we can’t have Rust ruin the game so quickly, so we want to suppress that pesky warning
about uncommon codepoints which points directly at our deception:</p>
<pre><pre class="playground"><code class="language-rust">#![allow(uncommon_codepoints)]

#[derive(Debug)]
enum Foo { ﾠBar }

<span class="boring">fn main () {
</span>println!("{:?}", format!("{:?}", Foo::ﾠBar));
println!("{:?}", format!("{:?}", Foo::ﾠBar).as_bytes());
<span class="boring">}</span></code></pre></pre>
<pre><code class="language-text">$ rustc notacrime.rs

[Exit: 0]

$ ./notacrime
"ﾠBar"
[239, 190, 160, 66, 97, 114]

[Exit: 0]
</code></pre>
<p>Much better.</p>
<p>So, we’re printing the Debug representation of that <code>Bar</code> variant which starts with the Hangul
character we found, and the debug representation of the slice of bytes which underly that string.</p>
<p>The bytes, in hex, are:</p>
<pre><code class="language-text">[EF, BE, A0, 42, 61, 72]
</code></pre>
<p>0x42 0x61 0x72 are Unicode for <code>B</code>, <code>a</code>, and <code>r</code>, so our Hangul character must be 0xEF 0xBE 0xA0!</p>
<p>Indeed, that’s the <a href="https://en.wikipedia.org/wiki/UTF-8#Encoding">UTF-8 representation</a> of
<a href="https://util.unicode.org/UnicodeJsps/character.jsp?a=FFA0">0xFFA0</a>.</p>
<p>So, we’ve got something that is a valid start of an identifier, and (fonts willing) is completely
transparent. Let’s try this again:</p>
<pre><code class="language-rust ignore">#![allow(uncommon_codepoints)]
use u2::*;
enum u2 { ﾠ0, ﾠ1, ﾠ2, ﾠ3 }
<span class="boring">fn main () {
</span>assert_eq!(ﾠ0, ﾠ0);
<span class="boring">}</span></code></pre>
<pre><code class="language-text">$ rustc not-technically-illegal.rs
warning: type `u2` should have an upper camel case name
 --&gt; not-technically-illegal.rs:4:6
  |
4 | enum u2 { ﾠ0, ﾠ1, ﾠ2, ﾠ3 }
  |      ^^ help: convert the identifier to upper camel case (notice the capitalization): `U2`
  |
  = note: `#[warn(non_camel_case_types)]` on by default

error[E0369]: binary operation `==` cannot be applied to type `u2`
 --&gt; not-technically-illegal.rs:8:1
  |
8 | assert_eq!(ﾠ0, ﾠ0);
  | ^^^^^^^^^^^^^^^^^^^
  | |
  | u2
  | u2
  |
  = note: an implementation of `std::cmp::PartialEq` might be missing for `u2`
  = note: this error originates in the macro `assert_eq` (in Nightly builds, run with -Z macro-backtrace for more info)

error[E0277]: `u2` doesn't implement `Debug`
 --&gt; not-technically-illegal.rs:8:1
  |
8 | assert_eq!(ﾠ0, ﾠ0);
  | ^^^^^^^^^^^^^^^^^^^ `u2` cannot be formatted using `{:?}`
  |
  = help: the trait `Debug` is not implemented for `u2`
  = note: add `#[derive(Debug)]` to `u2` or manually `impl Debug for u2`
  = note: this error originates in the macro `assert_eq` (in Nightly builds, run with -Z macro-backtrace for more info)

[Exit: 1]
</code></pre>
<p>Whoa there.</p>
<p>Okay, so we’re going to rename our enum to uppercase, and add some derived traits:</p>
<pre><code class="language-rust ignore">#![allow(uncommon_codepoints)]

use U2::*;

#[derive(Clone, Copy, Debug, PartialEq, Eq)]
enum U2 { ﾠ0, ﾠ1, ﾠ2, ﾠ3 }

<span class="boring">fn main () {
</span>assert_eq!(ﾠ0, ﾠ0);
<span class="boring">}</span></code></pre>
<pre><code class="language-text">$ rustc not-technically-illegal.rs
warning: variant is never constructed: `ﾠ1`
 --&gt; not-technically-illegal.rs:6:15
  |
6 | enum U2 { ﾠ0, ﾠ1, ﾠ2, ﾠ3 }
  |               ^^
  |
  = note: `#[warn(dead_code)]` on by default

warning: variant is never constructed: `ﾠ2`
 --&gt; not-technically-illegal.rs:6:19
  |
6 | enum U2 { ﾠ0, ﾠ1, ﾠ2, ﾠ3 }
  |                   ^^

warning: variant is never constructed: `ﾠ3`
 --&gt; not-technically-illegal.rs:6:23
  |
6 | enum U2 { ﾠ0, ﾠ1, ﾠ2, ﾠ3 }
  |                       ^^

warning: 3 warnings emitted

[Exit: 0]
</code></pre>
<p>Well, it succeeded, but let’s suppress those warnings as well:</p>
<pre><code class="language-rust ignore">#![allow(uncommon_codepoints)]

use U2::*;

#[derive(Clone, Copy, Debug, PartialEq, Eq)]
#[allow(dead_code)]
enum U2 { ﾠ0, ﾠ1, ﾠ2, ﾠ3 }

<span class="boring">fn main () {
</span>assert_eq!(ﾠ0, ﾠ0);
<span class="boring">}</span></code></pre>
<pre><code class="language-text">$ rustc not-technically-illegal.rs

[Exit: 0]

$ ./not-technically-illegal

[Exit: 0]
</code></pre>
<p>Excellent.</p>
<hr />
<p>Now, we’re not going to get far with a 2-bit int. But writing out all the variants of a wider
integer is going to get old fast. So let’s make a generator for our Rust crimes:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>println!("enum U8 {{ {} }}",
    (0..256).map(|n| format!("\u{FFA0}{}", n)).collect::&lt;Vec&lt;_&gt;&gt;().join(", ")
);
<span class="boring">}</span></code></pre></pre>
<p>The output is very long and it’s only going to get longer, so from now you can run these yourself
with the little ⏵ play icon on the code listing.</p>
<p>Let’s just go ahead and add all the other decoration we’ve established to that little generator,
but do something a little more interesting: addition.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span>println!("#![allow(uncommon_codepoints)]\n\n");

println!("use U8::*;

#[derive(Clone, Copy, Debug, PartialEq, Eq)]
#[allow(dead_code)]
enum U8 {{ {} }}",
    (0..256).map(|n| format!("\u{FFA0}{}", n)).collect::&lt;Vec&lt;_&gt;&gt;().join(", ")
);

println!("

fn main() {{
    dbg!(\u{FFA0}1 + \u{FFA0}2);
}}");
<span class="boring">}</span></code></pre></pre>
<pre><code class="language-text">$ rustc crime-scene.rs &amp;&amp; ./crime-scene &gt; crime.rs &amp;&amp; rustc crime.rs &amp;&amp; ./crime
error[E0369]: cannot add `U8` to `U8`
 --&gt; crime.rs:9:13
  |
9 |     dbg!(ﾠ1 + ﾠ2);
  |          -- ^ -- U8
  |          |
  |          U8
  |
  = note: an implementation of `std::ops::Add` might be missing for `U8`

error: aborting due to previous error

For more information about this error, try `rustc --explain E0369`.

[Exit: 1]
</code></pre>
<p>Now what?</p>
<p>Ah, right, we haven’t defined how addition works for our new integer type. Let’s do that:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span><span class="boring">println!("#![allow(uncommon_codepoints)]\n\n");
</span><span class="boring">
</span><span class="boring">println!("use U8::*;
</span><span class="boring">
</span><span class="boring">#[derive(Clone, Copy, Debug, PartialEq, Eq)]
</span><span class="boring">#[allow(dead_code)]
</span><span class="boring">enum U8 {{ {} }}",
</span><span class="boring">    (0..256).map(|n| format!("\u{FFA0}{}", n)).collect::&lt;Vec&lt;_&gt;&gt;().join(", ")
</span><span class="boring">);
</span><span class="boring">
</span><span class="boring">println!("
</span><span class="boring">
</span><span class="boring">fn main() {{
</span><span class="boring">    dbg!(\u{FFA0}1 + \u{FFA0}2);
</span><span class="boring">}}");
</span><span class="boring">
</span>println!("
use std::ops::Add;

impl Add for U8 {{
    type Output = Self;
    fn add(self, other: Self) -&gt; Self {{
        U8::from(u8::from(self) + u8::from(other))
    }}
}}");
<span class="boring">}</span></code></pre></pre>
<p>…what?</p>
<p>Right, I’ve skipped a few things.</p>
<p>So, it may be technically possible to define addition without making any reference to Rust’s core
integer types. But that seems <em>very</em> out of scope for an article which is already pretty long.
Instead, we’re going to implement arithmetic by converting our custom enum integers to their
corresponding native ints, do maths, and then go back.</p>
<p>How do we convert?</p>
<p>Well, going from our type to a primitive is pretty simple:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span><span class="boring">println!("#![allow(uncommon_codepoints)]\n\n");
</span><span class="boring">
</span><span class="boring">println!("use U8::*;
</span><span class="boring">
</span><span class="boring">#[derive(Clone, Copy, Debug, PartialEq, Eq)]
</span><span class="boring">#[allow(dead_code)]
</span><span class="boring">enum U8 {{ {} }}",
</span><span class="boring">    (0..256).map(|n| format!("\u{FFA0}{}", n)).collect::&lt;Vec&lt;_&gt;&gt;().join(", ")
</span><span class="boring">);
</span><span class="boring">
</span><span class="boring">println!("
</span><span class="boring">
</span><span class="boring">fn main() {{
</span><span class="boring">    dbg!(u8::from(\u{FFA0}0));
</span><span class="boring">}}");
</span><span class="boring">
</span>println!("

impl From&lt;U8&gt; for u8 {{
    fn from(n: U8) -&gt; Self {{
        n as _
    }}
}}");
<span class="boring">}</span></code></pre></pre>
<p>Going back, however, requires a few more pieces:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span><span class="boring">println!("#![allow(uncommon_codepoints)]\n\n");
</span><span class="boring">
</span>println!("use U8::*;

#[derive(Clone, Copy, Debug, PartialEq, Eq)]
#[allow(dead_code)]
#[repr(u8)] // &lt;===================== this thing
enum U8 {{ {} }}",
    (0..256).map(|n| format!("\u{FFA0}{}", n)).collect::&lt;Vec&lt;_&gt;&gt;().join(", ")
);
<span class="boring">
</span><span class="boring">println!("
</span><span class="boring">
</span><span class="boring">fn main() {{
</span><span class="boring">    dbg!(U8::from(0));
</span><span class="boring">}}");
</span><span class="boring">
</span>println!("
<span class="boring">
</span><span class="boring">impl From&lt;U8&gt; for u8 {{
</span><span class="boring">    fn from(n: U8) -&gt; Self {{
</span><span class="boring">        n as _
</span><span class="boring">    }}
</span><span class="boring">}}
</span>
impl From&lt;u8&gt; for U8 {{
    fn from(n: u8) -&gt; Self {{
        unsafe {{ std::mem::transmute(n) }}
    }}
}}");
<span class="boring">}</span></code></pre></pre>
<p>UNSAFE?!?!?</p>
<p>Well, not quite.</p>
<p>Say we have an enum with four variants. We can safely convert it to a number, because the compiler
knows statically which variant corresponds to which number. However, we can’t safely go the other
way all the time, because what if we try to convert 32 into that enum? There’s no 33rd variant, so
the program may crash, or worse.</p>
<p>In our case, though, we know that there are exactly 256 variants, as many values as there are in an
<code>u8</code>, so we can assure the compiler that yes, we know what we’re about, please transmute.</p>
<p>And we tell the compiler that the enum must fit in and have the same layout as a <code>u8</code> with the
<code>repr</code> annotation, which lets us have peace of mind while transmuting, that an optimisation isn’t
going to come along and mess up our assumptions.</p>
<p>Now that we can go back and forth between <code>U8</code> and <code>u8</code>, we can get back to implementing addition:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span><span class="boring">println!("#![allow(uncommon_codepoints)]\n\n");
</span><span class="boring">
</span><span class="boring">println!("use U8::*;
</span><span class="boring">
</span><span class="boring">#[derive(Clone, Copy, Debug, PartialEq, Eq)]
</span><span class="boring">#[allow(dead_code)]
</span><span class="boring">#[repr(u8)]
</span><span class="boring">enum U8 {{ {} }}",
</span><span class="boring">    (0..256).map(|n| format!("\u{FFA0}{}", n)).collect::&lt;Vec&lt;_&gt;&gt;().join(", ")
</span><span class="boring">);
</span><span class="boring">
</span>println!("
<span class="boring">
</span>fn main() {{
    dbg!(\u{FFA0}1 + \u{FFA0}2);
}}");

println!("
<span class="boring">
</span><span class="boring">impl From&lt;U8&gt; for u8 {{
</span><span class="boring">    fn from(n: U8) -&gt; Self {{
</span><span class="boring">        n as _
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span><span class="boring">impl From&lt;u8&gt; for U8 {{
</span><span class="boring">    fn from(n: u8) -&gt; Self {{
</span><span class="boring">        unsafe {{ std::mem::transmute(n) }}
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span>use std::ops::Add;

impl Add for U8 {{
    type Output = Self;
    fn add(self, other: Self) -&gt; Self {{
        U8::from(u8::from(self) + u8::from(other))
    }}
}}");
<span class="boring">}</span></code></pre></pre>
<pre><code class="language-text">$ rustc crime-scene.rs &amp;&amp; ./crime-scene &gt; crime.rs &amp;&amp; rustc crime.rs &amp;&amp; ./crime

[crime.rs:9] ﾠ1 + ﾠ2 = ﾠ3

[Exit: 0]
</code></pre>
<p>It works!</p>
<p>In the same vein, we can implement <code>-</code>, <code>/</code>, and <code>*</code>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span><span class="boring">println!("#![allow(uncommon_codepoints)]\n\n");
</span><span class="boring">
</span><span class="boring">println!("use U8::*;
</span><span class="boring">
</span><span class="boring">#[derive(Clone, Copy, Debug, PartialEq, Eq)]
</span><span class="boring">#[allow(dead_code)]
</span><span class="boring">#[repr(u8)]
</span><span class="boring">enum U8 {{ {} }}",
</span><span class="boring">    (0..256).map(|n| format!("\u{FFA0}{}", n)).collect::&lt;Vec&lt;_&gt;&gt;().join(", ")
</span><span class="boring">);
</span><span class="boring">
</span><span class="boring">println!("
</span><span class="boring">
</span><span class="boring">fn main() {{
</span><span class="boring">    dbg!(\u{FFA0}1 + \u{FFA0}2 * \u{FFA0}3 / \u{FFA0}4);
</span><span class="boring">}}");
</span><span class="boring">
</span>println!("
<span class="boring">
</span><span class="boring">impl From&lt;U8&gt; for u8 {{
</span><span class="boring">    fn from(n: U8) -&gt; Self {{
</span><span class="boring">        n as _
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span><span class="boring">impl From&lt;u8&gt; for U8 {{
</span><span class="boring">    fn from(n: u8) -&gt; Self {{
</span><span class="boring">        unsafe {{ std::mem::transmute(n) }}
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span><span class="boring">use std::ops::Add;
</span><span class="boring">
</span><span class="boring">impl Add for U8 {{
</span><span class="boring">    type Output = Self;
</span><span class="boring">    fn add(self, other: Self) -&gt; Self {{
</span><span class="boring">        U8::from(u8::from(self) + u8::from(other))
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span>use std::ops::Sub;

impl Sub for U8 {{
    type Output = Self;
    fn sub(self, other: Self) -&gt; Self {{
        U8::from(u8::from(self) - u8::from(other))
    }}
}}

use std::ops::Div;

impl Div for U8 {{
    type Output = Self;
    fn div(self, other: Self) -&gt; Self {{
        U8::from(u8::from(self) / u8::from(other))
    }}
}}

use std::ops::Mul;

impl Mul for U8 {{
    type Output = Self;
    fn mul(self, other: Self) -&gt; Self {{
        U8::from(u8::from(self) * u8::from(other))
    }}
}}");
<span class="boring">}</span></code></pre></pre>
<p>With that, we can implement something a little less trivial than base arithmetic:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span><span class="boring">println!("#![allow(uncommon_codepoints)]\n\n");
</span><span class="boring">
</span><span class="boring">println!("use U8::*;
</span><span class="boring">
</span><span class="boring">#[derive(Clone, Copy, Debug, PartialEq, Eq)]
</span><span class="boring">#[allow(dead_code)]
</span><span class="boring">#[repr(u8)]
</span><span class="boring">enum U8 {{ {} }}",
</span><span class="boring">    (0..256).map(|n| format!("\u{FFA0}{}", n)).collect::&lt;Vec&lt;_&gt;&gt;().join(", ")
</span><span class="boring">);
</span><span class="boring">
</span>println!("

fn fibonacci(n: U8) -&gt; U8 {{
   match n {{
       \u{FFA0}0 =&gt; \u{FFA0}1,
       \u{FFA0}1 =&gt; \u{FFA0}1,
        _ =&gt; fibonacci(n - \u{FFA0}1) + fibonacci(n - \u{FFA0}2),
    }}
}}

fn main() {{
    dbg!(fibonacci(\u{FFA0}8));
}}");
<span class="boring">
</span><span class="boring">println!("
</span><span class="boring">
</span><span class="boring">impl From&lt;U8&gt; for u8 {{
</span><span class="boring">    fn from(n: U8) -&gt; Self {{
</span><span class="boring">        n as _
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span><span class="boring">impl From&lt;u8&gt; for U8 {{
</span><span class="boring">    fn from(n: u8) -&gt; Self {{
</span><span class="boring">        unsafe {{ std::mem::transmute(n) }}
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span><span class="boring">use std::ops::Add;
</span><span class="boring">
</span><span class="boring">impl Add for U8 {{
</span><span class="boring">    type Output = Self;
</span><span class="boring">    fn add(self, other: Self) -&gt; Self {{
</span><span class="boring">        U8::from(u8::from(self) + u8::from(other))
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span><span class="boring">use std::ops::Sub;
</span><span class="boring">
</span><span class="boring">impl Sub for U8 {{
</span><span class="boring">    type Output = Self;
</span><span class="boring">    fn sub(self, other: Self) -&gt; Self {{
</span><span class="boring">        U8::from(u8::from(self) - u8::from(other))
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span><span class="boring">use std::ops::Div;
</span><span class="boring">
</span><span class="boring">impl Div for U8 {{
</span><span class="boring">    type Output = Self;
</span><span class="boring">    fn div(self, other: Self) -&gt; Self {{
</span><span class="boring">        U8::from(u8::from(self) / u8::from(other))
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span><span class="boring">use std::ops::Mul;
</span><span class="boring">
</span><span class="boring">impl Mul for U8 {{
</span><span class="boring">    type Output = Self;
</span><span class="boring">    fn mul(self, other: Self) -&gt; Self {{
</span><span class="boring">        U8::from(u8::from(self) * u8::from(other))
</span><span class="boring">    }}
</span><span class="boring">}}");
</span><span class="boring">}</span></code></pre></pre>
<pre><code class="language-text">$ rustc crime-scene.rs &amp;&amp; ./crime-scene &gt; crime.rs &amp;&amp; rustc crime.rs &amp;&amp; ./crime

[crime.rs:17] fibonacci(ﾠ8) = ﾠ34

[Exit: 0]
</code></pre>
<hr />
<p>Alright, so we’ve got maths on a single, non-primitive, enum-based integer type. Can we add another
type and sidestep the ambiguity issue?</p>
<p>Yes, by adding another Hangul Filler as prefix!</p>
<p>First let’s move some of our machinery into functions so we’re a bit more generic when generating:</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    println!("#![allow(uncommon_codepoints)]

    use U8::*;

    fn fibonacci(n: U8) -&gt; U8 {{
       match n {{
           \u{FFA0}0 =&gt; \u{FFA0}1,
           \u{FFA0}1 =&gt; \u{FFA0}1,
            _ =&gt; fibonacci(n - \u{FFA0}1) + fibonacci(n - \u{FFA0}2),
        }}
    }}

    fn main() {{
        dbg!(fibonacci(\u{FFA0}8));
    }}");

    define_enum("U8", "u8", "\u{FFA0}", 0..256);
}

fn define_enum(name: &amp;str, repr: &amp;str, prefix: &amp;str, range: std::ops::Range&lt;usize&gt;) {
println!("
#[derive(Clone, Copy, Debug, PartialEq, Eq)]
#[allow(dead_code)]
#[repr({repr})]
enum {name} {{ {def} }}",
    name=name,
    repr=repr,
    def=range.map(|n| format!("{}{}", prefix, n)).collect::&lt;Vec&lt;_&gt;&gt;().join(", "),
);

println!("

impl From&lt;{name}&gt; for {repr} {{
    fn from(n: {name}) -&gt; Self {{
        n as _
    }}
}}

impl From&lt;{repr}&gt; for {name} {{
    fn from(n: {repr}) -&gt; Self {{
        unsafe {{ std::mem::transmute(n) }}
    }}
}}

impl std::ops::Add for {name} {{
    type Output = Self;
    fn add(self, other: Self) -&gt; Self {{
        {name}::from({repr}::from(self) + {repr}::from(other))
    }}
}}

impl std::ops::Sub for {name} {{
    type Output = Self;
    fn sub(self, other: Self) -&gt; Self {{
        {name}::from({repr}::from(self) - {repr}::from(other))
    }}
}}

impl std::ops::Div for {name} {{
    type Output = Self;
    fn div(self, other: Self) -&gt; Self {{
        {name}::from({repr}::from(self) / {repr}::from(other))
    }}
}}

impl std::ops::Mul for {name} {{
    type Output = Self;
    fn mul(self, other: Self) -&gt; Self {{
        {name}::from({repr}::from(self) * {repr}::from(other))
    }}
}}",
    name=name,
    repr=repr,
);
}</code></pre></pre>
<p>So now we can define another enum integer:</p>
<pre><code class="language-rust ignore">define_enum("U16", "u16", "\u{FFA0}\u{FFA0}", 0..65536);</code></pre>
<p>If you try to compile this, you’re going to hit a limitation of the compiler: it gets very very
slow to compile… whoa, <em>seven hundred kilobytes</em> of source?</p>
<p>Right, so that’s a <strong>lot</strong>. In the interest of keeping this demo-able, let’s define our own type to
be a little smaller. Let’s say we want a <code>U12</code>, which goes from 0 to 4095, backed by a <code>u16</code>:</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    println!("#![allow(uncommon_codepoints)]

    use U8::*;
    use U12::*;

    fn fibonacci(n: U8) -&gt; U8 {{
       match n {{
           \u{FFA0}0 =&gt; \u{FFA0}1,
           \u{FFA0}1 =&gt; \u{FFA0}1,
            _ =&gt; fibonacci(n - \u{FFA0}1) + fibonacci(n - \u{FFA0}2),
        }}
    }}

    fn main() {{
        dbg!(fibonacci(\u{FFA0}8));
    }}");

    define_enum("U8", "u8", "\u{FFA0}", 0..256);
    define_enum("U12", "u16", "\u{FFA0}\u{FFA0}", 0..4096);
}

fn define_enum(name: &amp;str, repr: &amp;str, prefix: &amp;str, range: std::ops::Range&lt;usize&gt;) {
println!("
<span class="boring">#[derive(Clone, Copy, Debug, PartialEq, Eq)]
</span><span class="boring">#[allow(dead_code)]
</span><span class="boring">#[repr({repr})]
</span><span class="boring">enum {name} {{ {def} }}",
</span><span class="boring">    name=name,
</span><span class="boring">    repr=repr,
</span><span class="boring">    def=range.clone().map(|n| format!("{}{}", prefix, n)).collect::&lt;Vec&lt;_&gt;&gt;().join(", "),
</span><span class="boring">);
</span><span class="boring">
</span><span class="boring">println!("
</span><span class="boring">
</span><span class="boring">impl From&lt;{name}&gt; for {repr} {{
</span><span class="boring">    fn from(n: {name}) -&gt; Self {{
</span><span class="boring">        n as _
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span>// ...
impl From&lt;{repr}&gt; for {name} {{
    fn from(n: {repr}) -&gt; Self {{
        assert!(n &lt; {max});
        unsafe {{ std::mem::transmute(n) }}
    }}
}}
// ...
<span class="boring">
</span><span class="boring">impl std::ops::Add for {name} {{
</span><span class="boring">    type Output = Self;
</span><span class="boring">    fn add(self, other: Self) -&gt; Self {{
</span><span class="boring">        {name}::from({repr}::from(self) + {repr}::from(other))
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span><span class="boring">impl std::ops::Sub for {name} {{
</span><span class="boring">    type Output = Self;
</span><span class="boring">    fn sub(self, other: Self) -&gt; Self {{
</span><span class="boring">        {name}::from({repr}::from(self) - {repr}::from(other))
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span><span class="boring">impl std::ops::Div for {name} {{
</span><span class="boring">    type Output = Self;
</span><span class="boring">    fn div(self, other: Self) -&gt; Self {{
</span><span class="boring">        {name}::from({repr}::from(self) / {repr}::from(other))
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span><span class="boring">impl std::ops::Mul for {name} {{
</span><span class="boring">    type Output = Self;
</span><span class="boring">    fn mul(self, other: Self) -&gt; Self {{
</span><span class="boring">        {name}::from({repr}::from(self) * {repr}::from(other))
</span><span class="boring">    }}
</span><span class="boring">}}
</span>",
    name=name,
    repr=repr,
    max=range.last().unwrap(),
);
}</code></pre></pre>
<p>Notice we add an assert to the transmuting conversion as now we can’t guarantee at compile time that
the entire possible range of an <code>u16</code> will fit in a <code>U12</code>, so we check the value at runtime, just to
be safe.</p>
<pre><code class="language-text">$ rustc crime-scene.rs &amp;&amp; ./crime-scene &gt; crime.rs &amp;&amp; rustc crime.rs &amp;&amp; ./crime
warning: unused import: `U12::*`
 --&gt; crime.rs:4:9
  |
4 |     use U12::*;
  |         ^^^^^^
  |
  = note: `#[warn(unused_imports)]` on by default

warning: 1 warning emitted

[crime.rs:15] fibonacci(ﾠ8) = ﾠ34

[Exit: 0]
</code></pre>
<p>We get a warning, but notice how we’re allowed to wildcard-import both sets of numbers (because of
course, from Rust’s point of view, they’re different identifiers).</p>
<p>With bigger ints, we can go for bigger maths:</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    println!("#![allow(uncommon_codepoints)]

    use U8::*;
    use U12::*;

    fn fibonacci(n: U8) -&gt; U8 {{
       match n {{
           \u{FFA0}0 =&gt; \u{FFA0}1,
           \u{FFA0}1 =&gt; \u{FFA0}1,
            _ =&gt; fibonacci(n - \u{FFA0}1) + fibonacci(n - \u{FFA0}2),
        }}
    }}

    fn factorial(n: U12) -&gt; U12 {{
        match n {{
          \u{FFA0}\u{FFA0}0 | \u{FFA0}\u{FFA0}1 =&gt; \u{FFA0}\u{FFA0}1,
          _ =&gt; factorial(n - \u{FFA0}\u{FFA0}1) * n
        }}
    }}

    fn main() {{
        dbg!(fibonacci(\u{FFA0}8));
        dbg!(factorial(\u{FFA0}\u{FFA0}6));
    }}");

    define_enum("U8", "u8", "\u{FFA0}", 0..256);
    define_enum("U12", "u16", "\u{FFA0}\u{FFA0}", 0..4096);
}
<span class="boring">
</span><span class="boring">fn define_enum(name: &amp;str, repr: &amp;str, prefix: &amp;str, range: std::ops::Range&lt;usize&gt;) {
</span><span class="boring">println!("
</span><span class="boring">#[derive(Clone, Copy, Debug, PartialEq, Eq)]
</span><span class="boring">#[allow(dead_code)]
</span><span class="boring">#[repr({repr})]
</span><span class="boring">enum {name} {{ {def} }}",
</span><span class="boring">    name=name,
</span><span class="boring">    repr=repr,
</span><span class="boring">    def=range.clone().map(|n| format!("{}{}", prefix, n)).collect::&lt;Vec&lt;_&gt;&gt;().join(", "),
</span><span class="boring">);
</span><span class="boring">
</span><span class="boring">println!("
</span><span class="boring">
</span><span class="boring">impl From&lt;{name}&gt; for {repr} {{
</span><span class="boring">    fn from(n: {name}) -&gt; Self {{
</span><span class="boring">        n as _
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span><span class="boring">impl From&lt;{repr}&gt; for {name} {{
</span><span class="boring">    fn from(n: {repr}) -&gt; Self {{
</span><span class="boring">        assert!(n &lt; {max});
</span><span class="boring">        unsafe {{ std::mem::transmute(n) }}
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span><span class="boring">impl std::ops::Add for {name} {{
</span><span class="boring">    type Output = Self;
</span><span class="boring">    fn add(self, other: Self) -&gt; Self {{
</span><span class="boring">        {name}::from({repr}::from(self) + {repr}::from(other))
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span><span class="boring">impl std::ops::Sub for {name} {{
</span><span class="boring">    type Output = Self;
</span><span class="boring">    fn sub(self, other: Self) -&gt; Self {{
</span><span class="boring">        {name}::from({repr}::from(self) - {repr}::from(other))
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span><span class="boring">impl std::ops::Div for {name} {{
</span><span class="boring">    type Output = Self;
</span><span class="boring">    fn div(self, other: Self) -&gt; Self {{
</span><span class="boring">        {name}::from({repr}::from(self) / {repr}::from(other))
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">
</span><span class="boring">impl std::ops::Mul for {name} {{
</span><span class="boring">    type Output = Self;
</span><span class="boring">    fn mul(self, other: Self) -&gt; Self {{
</span><span class="boring">        {name}::from({repr}::from(self) * {repr}::from(other))
</span><span class="boring">    }}
</span><span class="boring">}}
</span><span class="boring">",
</span><span class="boring">    name=name,
</span><span class="boring">    repr=repr,
</span><span class="boring">    max=range.last().unwrap(),
</span><span class="boring">);
</span><span class="boring">}</span></code></pre></pre>
<pre><code class="language-text">$ rustc crime-scene.rs &amp;&amp; ./crime-scene &gt; crime.rs &amp;&amp; rustc crime.rs &amp;&amp; ./crime

[crime.rs:22] fibonacci(ﾠ8) = ﾠ34
[crime.rs:23] factorial(ﾠﾠ6) = ﾠﾠ720

[Exit: 0]
</code></pre>
<hr />
<p>All that’s left to do is take the generated crime, stick it in a playground, add some whitespace to
confuse unexpecting visitors and… sit back to enjoy the profits:</p>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=f6d61baf31e9a9f4f97f07d334f56f12">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=f6d61baf31e9a9f4f97f07d334f56f12</a></p>
<hr />
<h3 id="update-safe-math"><a class="header" href="#update-safe-math">Update: safe math</a></h3>
<p><a href="https://www.reddit.com/r/rust/comments/pyuhd4/comment/heym0k8/">Reddit delivered</a> with a
<code>successor</code>-based implementation of maths that does not rely on transmutation. It does rely on
generating another large <code>match</code> for each enum. I also had to modify the code a little to make it
compile, and I used a wrapping successor function to simplify implementation.</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    println!("#![allow(uncommon_codepoints)]
    #![deny(unsafe_code)]

    use U7::*;
    use U13::*;

    fn fibonacci(n: U7) -&gt; U7 {{
        match n {{
           \u{FFA0}0 =&gt; \u{FFA0}1,
           \u{FFA0}1 =&gt; \u{FFA0}1,
            _ =&gt; fibonacci(n - \u{FFA0}1) + fibonacci(n - \u{FFA0}2),
        }}
    }}

    fn factorial(n: U13) -&gt; U13 {{
        match n {{
          \u{FFA0}\u{FFA0}0 | \u{FFA0}\u{FFA0}1 =&gt; \u{FFA0}\u{FFA0}1,
          _ =&gt; factorial(n - \u{FFA0}\u{FFA0}1) * n
        }}
    }}

    fn main() {{
        dbg!(fibonacci(\u{FFA0}8));
        dbg!(factorial(\u{FFA0}\u{FFA0}6));
    }}");

    define_enum(7, "\u{FFA0}");
    define_enum(13, "\u{FFA0}\u{FFA0}");
}

fn define_enum(width: u32, prefix: &amp;str) {
let name = format!("U{}", width);
let max = 2_usize.pow(width);
let range = 0..max;
let succrange = range.clone().rev();

println!("
#[derive(Clone, Copy, Debug, PartialEq, Eq)]
#[allow(dead_code)]
enum {name} {{ {def} }}

impl {name} {{
    fn successor(self) -&gt; Self {{
        match self {{ {prefix}{max} =&gt; {prefix}0, {succ} }}
    }}
}}
",
    name=name,
    def=range.clone().map(|n| format!("{}{}", prefix, n)).collect::&lt;Vec&lt;_&gt;&gt;().join(", "),
    succ=succrange.clone().zip(succrange.clone().skip(1)).map(|(n, m)| format!("{p}{m} =&gt; {p}{n}", p=prefix, m=m, n=n)).collect::&lt;Vec&lt;_&gt;&gt;().join(", "),
    max=range.clone().last().unwrap(),
    prefix=prefix,
);

println!("
impl std::cmp::PartialOrd for {name} {{
    fn partial_cmp(&amp;self, other: &amp;Self) -&gt; Option&lt;std::cmp::Ordering&gt; {{
        if self == other {{
            return Some(std::cmp::Ordering::Equal);
        }}
        let mut x = *self;
        let mut y = *other;
        Some(loop {{
            if x == {prefix}{max} {{
                break std::cmp::Ordering::Greater;
            }}
            if y == {prefix}{max} {{
                break std::cmp::Ordering::Less;
            }}
            x = x.successor();
            y = y.successor();
        }})
    }}
}}

impl std::ops::Add for {name} {{
    type Output = Self;
    fn add(mut self, y: Self) -&gt; Self::Output {{
        let mut n = {prefix}0;
        while n != y {{
            self = self.successor();
            n = n.successor();
        }}
        self
    }}
}}

impl std::ops::Sub for {name} {{
    type Output = Self;
    fn sub(self, mut y: Self) -&gt; Self::Output {{
        let mut n = {prefix}0;
        while self != y {{
            y = y.successor();
            n = n.successor();
        }}
        n
    }}
}}

impl std::ops::Mul for {name} {{
    type Output = Self;
    fn mul(self, y: Self) -&gt; Self::Output {{
        let mut n = {prefix}0;
        let mut res = {prefix}0;
        while n != y {{
            n = n.successor();
            res = res + self;
        }}
        res
    }}
}}
",
    name=name,
    prefix=prefix,
    max=range.last().unwrap(),
);
}</code></pre></pre>
<pre><code class="language-text">$ rustc crime-sux.rs &amp;&amp; ./crime-sux &gt; crime.rs &amp;&amp; rustc crime.rs &amp;&amp; ./crime

[crime.rs:23] fibonacci(ﾠ8) = ﾠ34
[crime.rs:24] factorial(ﾠﾠ6) = ﾠﾠ720

[Exit: 0]
</code></pre>
<p>No unsafe! (<a href="https://twitter.com/workingjubilee/status/1443619086655627291">“Hello, I would like a U7 and a U13…”</a>)</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../technical/just-a-bit-of-wasi.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../technical/exploring-wasm.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../technical/just-a-bit-of-wasi.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../technical/exploring-wasm.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
